# Html MGraph Service - LLM Brief

**version** v1.4.0
**Last Updated**: 22nd December 2025

## Overview

The **Html_MGraph Service** is a system that transforms HTML documents into graph representations, enabling powerful visualization, analysis, and manipulation of HTML structure. It converts HTML into a multi-graph model where different aspects of the document (DOM structure, attributes, scripts, styles) are represented as interconnected graphs.

---

## Table of Contents

1. [Core Concept](#1-core-concept)
2. [Architecture](#2-architecture)
3. [The HTML Processing Pipeline](#3-the-html-processing-pipeline)
4. [Graph Structure](#4-graph-structure)
5. [Transformation System](#5-transformation-system)
6. [Rendering Engines](#6-rendering-engines)
7. [Visualization UI](#7-visualization-ui)
8. [Key Features](#8-key-features)
9. [Use Cases](#9-use-cases)

---

## 1. Core Concept

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              CORE CONCEPT                                        │
│                                                                                  │
│    HTML Document  ──────►  Graph Representation  ──────►  Visual Output         │
│                                                                                  │
│    <html>                    ┌─────────────┐              ┌─────────────┐       │
│      <body>         ──►      │   Nodes     │      ──►     │   DOT       │       │
│        <div>                 │   Edges     │              │   D3        │       │
│      </body>                 │   Clusters  │              │   Cytoscape │       │
│    </html>                   └─────────────┘              │   VisJs     │       │
│                                                           │   Mermaid   │       │
│                                                           │   Tree      │       │
│                                                           └─────────────┘       │
└─────────────────────────────────────────────────────────────────────────────────┘
```

The system allows you to:
- **Parse** any HTML into a structured graph model
- **Transform** the graph using customizable transformations
- **Visualize** the result using multiple rendering engines
- **Analyze** HTML structure, relationships, and patterns
- **Round-trip** back to HTML with full fidelity

---

## 2. Architecture

### High-Level Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           SYSTEM ARCHITECTURE                                    │
└─────────────────────────────────────────────────────────────────────────────────┘

                              ┌─────────────────────┐
                              │    FastAPI Server   │
                              │  (Html_Graph__Web)  │
                              └──────────┬──────────┘
                                         │
                              ┌──────────▼──────────┐
                              │  Export Service     │
                              │  (Html_Graph__      │
                              │   Export__Service)  │
                              └──────────┬──────────┘
                                         │
              ┌──────────────────────────┼──────────────────────────┐
              │                          │                          │
              ▼                          ▼                          ▼
   ┌─────────────────────┐   ┌─────────────────────┐   ┌─────────────────────┐
   │   Transformations   │   │     Html_MGraph     │   │  Rendering Engines  │
   │                     │   │                     │   │                     │
   │  • Default          │   │  • Body Graph       │   │  • DOT (Graphviz)   │
   │  • Attributes View  │   │  • Head Graph       │   │  • D3               │
   │  • Full Document    │   │  • Attrs Graph      │   │  • Cytoscape        │
   │  • Scripts View     │   │  • Scripts Graph    │   │  • VisJs            │
   │  • Styles View      │   │  • Styles Graph     │   │  • Mermaid          │
   │  • Head View        │   │  • Document Graph   │   │  • Tree             │
   │  • Custom...        │   │                     │   │                     │
   └─────────────────────┘   └─────────────────────┘   └─────────────────────┘
```

### Component Breakdown

| Component | Purpose |
|-----------|---------|
| **Html_Graph__Web** | FastAPI server exposing REST endpoints |
| **Html_Graph__Export__Service** | Orchestrates the transformation pipeline |
| **Html_MGraph** | Multi-graph representation of HTML |
| **Transformations** | Customize which graph/view to render |
| **Engines** | Convert MGraph to visual output formats |
| **Data Extractor** | Extracts nodes/edges for visualization |

---

## 3. The HTML Processing Pipeline

### 5-Phase Pipeline

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        HTML PROCESSING PIPELINE                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

Phase 1                Phase 2                Phase 3              Phase 4              Phase 5
────────               ────────               ────────             ────────             ────────

┌─────────┐           ┌─────────────┐        ┌─────────┐         ┌─────────┐         ┌─────────┐
│  HTML   │──────────▶│ Html_MGraph │───────▶│ MGraph  │────────▶│ Engine  │────────▶│ Output  │
│ String  │           │ (Document)  │        │         │         │ Export  │         │         │
└─────────┘           └─────────────┘        └─────────┘         └─────────┘         └─────────┘
     │                      │                     │                    │                   │
     │                      │                     │                    │                   │
     ▼                      ▼                     ▼                    ▼                   ▼
html__to__           html_mgraph__to__      transform_           configure_*          transform_
html_mgraph()        mgraph()               mgraph()             callbacks            export()


TRANSFORMATION HOOKS AT EACH PHASE:
───────────────────────────────────

• Phase 1: Parse HTML, create multi-graph document
• Phase 2: Select which graph to render (body, head, attrs, full doc, etc.)
• Phase 3: Modify the MGraph (filter nodes, add metadata, etc.)
• Phase 4: Configure rendering engine (colors, shapes, layout, clusters)
• Phase 5: Post-process output (inject custom DOT, modify JSON, etc.)
```

### Pipeline Code Flow

```python
# Simplified export flow
def export(self, html: str, engine: str, transformation: str) -> Dict:
    
    # Phase 1: HTML → Html_MGraph
    html_mgraph = transformation.html__to__html_mgraph(html)
    
    # Phase 2: Html_MGraph → MGraph (select which graph)
    mgraph = transformation.html_mgraph__to__mgraph(html_mgraph)
    
    # Phase 3: Transform MGraph
    mgraph = transformation.transform_mgraph(mgraph)
    
    # Phase 4: Configure engine & export
    config = self.get_engine_config(engine)
    config = transformation.configure_<engine>(config)
    output = engine.export(mgraph, config)
    
    # Phase 5: Transform output
    output = transformation.transform_export(output)
    
    return output
```

---

## 4. Graph Structure

### Html_MGraph Document Model

The system represents HTML as **5 interconnected subgraphs**:

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           Html_MGraph Document                                   │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────────────┐   │
│    │                 │    │                 │    │                         │   │
│    │   HEAD GRAPH    │    │   BODY GRAPH    │    │    ATTRIBUTES GRAPH     │   │
│    │                 │    │                 │    │                         │   │
│    │  <head>         │    │  <body>         │    │  Tags + Attributes      │   │
│    │    ├─<title>    │    │    ├─<div>      │    │                         │   │
│    │    ├─<meta>     │    │    │  ├─<p>     │    │  tag ──▶ element        │   │
│    │    └─<link>     │    │    │  └─<span>  │    │            │            │   │
│    │                 │    │    └─<form>     │    │            ▼            │   │
│    │  DOM hierarchy  │    │                 │    │       attributes        │   │
│    │  for <head>     │    │  DOM hierarchy  │    │                         │   │
│    │                 │    │  for <body>     │    │  (3-node model)         │   │
│    └─────────────────┘    └─────────────────┘    └─────────────────────────┘   │
│                                                                                 │
│    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────────────┐   │
│    │                 │    │                 │    │                         │   │
│    │  SCRIPTS GRAPH  │    │  STYLES GRAPH   │    │    DOCUMENT GRAPH       │   │
│    │                 │    │                 │    │      (Meta View)        │   │
│    │  <script> tags  │    │  <style> tags   │    │                         │   │
│    │  and content    │    │  and CSS rules  │    │  html ──▶ subgraphs     │   │
│    │                 │    │                 │    │                         │   │
│    └─────────────────┘    └─────────────────┘    └─────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### Attribute Storage Model (3-Node Model)

Attributes use a sophisticated 3-node model that supports:
- Boolean attributes (`required`, `disabled`)
- Valued attributes (`class="container"`)
- Node reuse for efficiency

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                      ATTRIBUTE 3-NODE MODEL                                      │
└─────────────────────────────────────────────────────────────────────────────────┘

    HTML: <input class="form-control" required disabled>

    ┌─────────────┐
    │   element   │
    │   (input)   │
    └──────┬──────┘
           │
           │ attr edges
           │
    ┌──────┼──────┬──────────────┐
    │      │      │              │
    ▼      ▼      ▼              ▼
┌──────┐┌──────┐┌──────┐    ┌──────┐
│inst_0││inst_1││inst_2│    │inst_3│
│(pos) ││(pos) ││(pos) │    │(pos) │
└──┬───┘└──┬───┘└──┬───┘    └──┬───┘
   │       │       │           │
   │name   │name   │name       │name
   ▼       ▼       ▼           ▼
┌──────┐┌──────┐┌──────┐    ┌──────┐
│"class"││"req- ││"dis- │    │"type"│  ◀── NAME NODES (shared!)
│      ││uired"││abled"│    │      │
└──────┘└──────┘└──────┘    └──────┘
   │
   │value
   ▼
┌──────────┐
│"form-    │  ◀── VALUE NODE
│ control" │
└──────────┘

   ╳         ╳                        ◀── NO value edge = BOOLEAN ATTRIBUTE!


KEY FEATURES:
─────────────
✓ Boolean attrs: No value edge (required, disabled)
✓ Name reuse: Same attr name shares one node
✓ Value reuse: Same attr value shares one node
✓ Position: Stored on instance node
✓ Round-trip fidelity: <input required> → <input required> (not required="")
```

---

## 5. Transformation System

### Available Transformations

| Transformation | Description | Graph Used |
|----------------|-------------|------------|
| **Default** | Body DOM structure | body_graph |
| **Attributes View** | Tags and attributes | attrs_graph |
| **Full Document** | All subgraphs clustered | All 5 graphs |
| **Head View** | Head section structure | head_graph |
| **Scripts View** | Script elements and content | scripts_graph |
| **Styles View** | Style elements and CSS | styles_graph |

### Creating Custom Transformations

```python
from mgraph_ai_service_html_graph.service.html_graph__transformations.Graph_Transformation__Base import Graph_Transformation__Base

class My_Custom_Transformation(Graph_Transformation__Base):

    name        : str = "my-custom"
    label       : str = "My Custom View"
    description : str = "Custom visualization"

    # ═══════════════════════════════════════════════════════════════════════════
    # Phase 1: HTML → Html_MGraph
    # ═══════════════════════════════════════════════════════════════════════════

    def html__to__html_mgraph(self, html: str) -> Html_MGraph:
        # Custom parsing or preprocessing
        return super().html__to__html_mgraph(html)

    # ═══════════════════════════════════════════════════════════════════════════
    # Phase 2: Html_MGraph → MGraph (SELECT WHICH GRAPH)
    # ═══════════════════════════════════════════════════════════════════════════

    def html_mgraph__to__mgraph(self, html_mgraph: Html_MGraph) -> MGraph:
        # Choose which graph to visualize
        return html_mgraph.attrs_graph.mgraph  # Example: show attributes

    # ═══════════════════════════════════════════════════════════════════════════
    # Phase 3: MGraph Transformation
    # ═══════════════════════════════════════════════════════════════════════════

    def transform_mgraph(self, mgraph: MGraph) -> MGraph:
        # Filter, modify, or enhance the graph
        return mgraph

    # ═══════════════════════════════════════════════════════════════════════════
    # Phase 4: Engine Configuration
    # ═══════════════════════════════════════════════════════════════════════════

    def configure_dot(self, config: MGraph__Engine__Config__Dot) -> MGraph__Engine__Config__Dot:
        config.rankdir = 'LR'  # Left-to-right layout
        config.node_shape = 'box'
        return config

    # ═══════════════════════════════════════════════════════════════════════════
    # Phase 5: Output Transformation
    # ═══════════════════════════════════════════════════════════════════════════

    def transform_export(self, output: Any) -> Any:
        # Modify final output
        return output
```

### Full Document Transformation (Clustered View)

The Full Document transformation combines all 5 subgraphs into a clustered visualization:

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    FULL DOCUMENT CLUSTERED VIEW                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐  ┌─────────────────────┐  ┌─────────────────────────────────┐
│      Head       │  │        Body         │  │           Attributes            │
│     (blue)      │  │      (green)        │  │            (orange)             │
│                 │  │                     │  │                                 │
│   ┌───────┐     │  │   ┌───────┐         │  │  ┌──────┐  ┌──────┐  ┌──────┐  │
│   │<head> │     │  │   │<body> │         │  │  │<html>│  │<body>│  │<div> │  │
│   └───┬───┘     │  │   └───┬───┘         │  │  └──┬───┘  └──┬───┘  └──┬───┘  │
│       │         │  │       │             │  │     │        │        │       │
│   ┌───▼───┐     │  │   ┌───▼───┐         │  │     ▼        ▼        ▼       │
│   │<title>│     │  │   │ <div> │         │  │  ┌────────────────────────┐   │
│   └───────┘     │  │   └───┬───┘         │  │  │    element nodes       │   │
│                 │  │       │             │  │  └────────────────────────┘   │
└─────────────────┘  │   ┌───▼───┐         │  │              │                │
                     │   │  <p>  │         │  │              ▼                │
┌─────────────────┐  │   └───────┘         │  │  ┌────────────────────────┐   │
│     Scripts     │  │                     │  │  │   attr instances       │   │
│     (pink)      │  └─────────────────────┘  │  └────────────────────────┘   │
└─────────────────┘                           │              │                │
                                              │              ▼                │
┌─────────────────┐                           │  ┌────────────────────────┐   │
│     Styles      │                           │  │  names + values        │   │
│    (purple)     │                           │  └────────────────────────┘   │
└─────────────────┘                           └─────────────────────────────────┘

─────  Solid edges: Parent-child within cluster
─ ─ ─  Dashed edges: Cross-cluster references
```

---

## 6. Rendering Engines

### Available Engines

| Engine | Output Format | Best For |
|--------|---------------|----------|
| **DOT (Graphviz)** | DOT language → SVG | Static diagrams, documentation |
| **D3** | JSON for D3.js | Interactive web visualizations |
| **Cytoscape** | JSON for Cytoscape.js | Complex network analysis |
| **VisJs** | JSON for vis.js | Dynamic, physics-based layouts |
| **Mermaid** | Mermaid syntax | Markdown-embeddable diagrams |
| **Tree** | JSON tree structure | Hierarchical views |

### Engine Configuration

Each engine has a configuration class with customizable options:

```python
# DOT Engine Configuration
class MGraph__Engine__Config__Dot:
    rankdir      : str  = 'TB'           # Top-to-bottom, LR, RL, BT
    node_shape   : str  = 'ellipse'      # box, ellipse, diamond, etc.
    node_color   : str  = '#E8F5E9'      # Fill color
    edge_color   : str  = '#666666'      # Edge color
    font_name    : str  = 'Arial'
    font_size    : int  = 12
    enable_clusters: bool = False        # Enable subgraph clusters
    clusters     : Dict = {}             # Cluster definitions
```

### Engine-Specific Callbacks

Transformations can customize each engine:

```python
def configure_dot(self, config):
    config.rankdir = 'LR'
    config.enable_clusters = True
    config.add_cluster('body', label='Body', bgcolor='#E8F5E9')
    return config

def configure_d3(self, config):
    config.force_strength = -300
    config.link_distance = 100
    return config
```

---

## 7. Visualization UI

### UI Components

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           HTML GRAPH VISUALIZER UI                               │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌──────────────────┐  ┌────────────────────────────────────────────────────┐  │
│  │   HTML Input     │  │              Graph Visualization                   │  │
│  │                  │  │                                                    │  │
│  │  ┌────────────┐  │  │     Renderer: [DOT ▼]  Transform: [Default ▼]     │  │
│  │  │ <html>     │  │  │                                                    │  │
│  │  │   <body>   │  │  │         ┌───────┐                                  │  │
│  │  │     <div>  │  │  │         │<body> │                                  │  │
│  │  │     </div> │  │  │         └───┬───┘                                  │  │
│  │  │   </body>  │  │  │             │                                      │  │
│  │  │ </html>    │  │  │         ┌───▼───┐                                  │  │
│  │  └────────────┘  │  │         │ <div> │                                  │  │
│  │                  │  │         └───────┘                                  │  │
│  │  [Render Graph]  │  │                                                    │  │
│  │                  │  │                                                    │  │
│  └──────────────────┘  └────────────────────────────────────────────────────┘  │
│                                                                                 │
│  ┌──────────────────┐  ┌────────────────────────────────────────────────────┐  │
│  │  Configuration   │  │              Transformation Playground             │  │
│  │                  │  │                                                    │  │
│  │  Preset: [Full]  │  │  HTML ──▶ Html-Dict ──▶ Html_MGraph ──▶ HTML      │  │
│  │                  │  │                                                    │  │
│  │  • Show attrs    │  │  [View each stage of the transformation]           │  │
│  │  • Show text     │  │                                                    │  │
│  │  • Cluster view  │  │                                                    │  │
│  └──────────────────┘  └────────────────────────────────────────────────────┘  │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### Transformation Playground

The Transformation Playground allows debugging each stage of the pipeline:

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                      TRANSFORMATION PLAYGROUND                                   │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  Original HTML  │    │    Html-Dict    │    │   Created HTML  │
│                 │    │                 │    │                 │
│  <input         │    │  {              │    │  <input         │
│    required     │ ──▶│    "tag": "in.. │ ──▶│    required     │
│    class="x"    │    │    "attrs": {   │    │    class="x"    │
│  >              │    │      "required":│    │  />             │
│                 │    │        null,    │    │                 │
│                 │    │      "class":   │    │                 │
│                 │    │        "x"      │    │                 │
│                 │    │    }            │    │                 │
│                 │    │  }              │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘

        │                      │                      │
        │                      │                      │
        ▼                      ▼                      ▼
    [View]  [Edit]        [View]  [Edit]        [View]  [Edit]
```

---

## 8. Key Features

### Feature Summary

| Feature | Description |
|---------|-------------|
| **Multi-Graph Model** | 5 interconnected graphs for complete HTML representation |
| **Round-Trip Fidelity** | HTML → Graph → HTML preserves all structure |
| **Boolean Attribute Support** | Properly handles `required`, `disabled`, etc. |
| **Node Reuse** | Efficient storage with shared name/value nodes |
| **Pluggable Transformations** | Easy to create custom views |
| **Multiple Renderers** | DOT, D3, Cytoscape, VisJs, Mermaid, Tree |
| **Clustered Views** | Group subgraphs with colored clusters |
| **Visual Debugging** | See graph structure to debug issues |
| **REST API** | Full API for programmatic access |

### Round-Trip Guarantee

```
┌──────────────────┐         ┌──────────────────┐         ┌──────────────────┐
│                  │         │                  │         │                  │
│  <input          │  ────▶  │   Html_MGraph    │  ────▶  │  <input          │
│    required      │         │                  │         │    required      │
│    type="text">  │         │   (multi-graph   │         │    type="text">  │
│                  │         │    with 3-node   │         │                  │
│                  │         │    attr model)   │         │                  │
└──────────────────┘         └──────────────────┘         └──────────────────┘
       INPUT                      PROCESS                      OUTPUT
                                                                 │
                              ┌──────────────────────────────────┘
                              │
                              ▼
                        ┌───────────┐
                        │  INPUT    │
                        │    ==     │
                        │  OUTPUT   │
                        │    ✓      │
                        └───────────┘
```

---

## 9. Use Cases

### Web Scraping Analysis

Visualize DOM structure of scraped pages to understand layout patterns.

### HTML Diff Visualization

Compare two HTML documents by visualizing their graph representations.

### Accessibility Auditing

Analyze attribute patterns to check for missing ARIA attributes.

### DOM Manipulation Planning

Visualize before/after states when planning DOM transformations.

### Educational Tool

Teach HTML structure by showing visual graph representation.

### Security Analysis

Analyze script and style injection points in HTML documents.

---

## API Endpoints

```
POST /api/v1/html-graph/export
    Body: { "html": "<html>...", "engine": "dot", "transformation": "default" }
    Returns: { "output": "digraph {...}", "stats": {...} }

GET /api/v1/html-graph/engines
    Returns: ["dot", "d3", "cytoscape", "visjs", "mermaid", "tree"]

GET /api/v1/html-graph/transformations
    Returns: [{"name": "default", "label": "Default", ...}, ...]
```

---

## Quick Start Example

```python
from mgraph_ai_service_html_graph.service.html_graph.Html_Graph__Export__Service import Html_Graph__Export__Service

# Create export service
service = Html_Graph__Export__Service()

# Export HTML to DOT format
html = """
<html>
    <body>
        <div class="container">
            <p>Hello World</p>
        </div>
    </body>
</html>
"""

result = service.export(
    html           = html,
    engine         = 'dot',
    transformation = 'default'
)

print(result['output'])  # DOT graph output
```

---

## Summary

The Html_MGraph Service provides a powerful, flexible system for:

1. **Parsing** HTML into structured multi-graph representations
2. **Transforming** graphs through a 5-phase pipeline with hooks at each stage
3. **Visualizing** results using 6 different rendering engines
4. **Debugging** HTML structure through visual graph inspection
5. **Round-tripping** HTML with full fidelity including boolean attributes

The system is designed for extensibility - new transformations and engines can be added easily, and the 5-phase pipeline provides fine-grained control over every aspect of the visualization process.