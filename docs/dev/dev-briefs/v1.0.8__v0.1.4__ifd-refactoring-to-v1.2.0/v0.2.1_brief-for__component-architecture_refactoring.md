# Development Brief: v0.2.1 Component Architecture Refactoring

**Version**: v0.2.1  
**Type**: Minor version (builds on v0.2.0, can link back and override)  
**Purpose**: Extract shared CSS, HTML templates, and JavaScript utilities from components to enable easier iteration in subsequent v0.2.x versions

---

## 1. Context & Goals

### 1.1 Current State (v0.2.0)
The v0.2.0 consolidation brought together proven features from v0.1.x into a single codebase. However, components still contain:
- Inline `<style>` blocks (50-80 lines per component)
- Inline HTML templates in `render()` methods
- Duplicated utility functions (`escapeHtml`, `formatBytes`, `formatNumber`)
- Duplicated DOT parsing logic across 4 renderer components

### 1.2 Goals for v0.2.1
1. **Extract CSS** to external files loaded dynamically into Shadow DOM
2. **Extract HTML** templates to external files loaded via `fetch()`
3. **Create BaseComponent** class with shared utilities and lifecycle management
4. **Create DotParser** utility class for shared DOT parsing logic
5. **Establish patterns** that make v0.2.2+ modifications trivial

### 1.3 Success Criteria
- Components are 50-70% smaller in lines of code
- CSS changes require no JavaScript modifications
- HTML template changes require no JavaScript modifications
- Adding a new component follows a clear, minimal pattern
- All existing functionality works identically to v0.2.0

---

## 2. Architecture Decisions

### 2.1 Shadow DOM for Style Isolation
Each component will use Shadow DOM to:
- Encapsulate styles (no CSS leakage)
- Load component-specific CSS dynamically
- Enable clean template injection

### 2.2 Configuration-Driven Resource Paths
Resource paths will be configurable via a central config, enabling:
- Easy path overrides in v0.2.x minor versions
- Potential CDN deployment in future
- Testing with alternative resources

### 2.3 Template & CSS Loading Pattern
```
Component instantiation
    ‚Üí connectedCallback()
        ‚Üí loadResources() [async]
            ‚Üí fetch template HTML
            ‚Üí fetch component CSS
            ‚Üí inject into Shadow DOM
        ‚Üí setupEventListeners()
        ‚Üí emit 'component-ready' event
```

### 2.4 BaseComponent Inheritance
All components extend `BaseComponent` which provides:
- Resource loading infrastructure
- Common utility methods
- Event listener tracking and cleanup
- Standardized lifecycle hooks

---

## 3. File Structure for v0.2.1

```
v0.2.1/
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ playground.html
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ component-paths.js          # NEW: Configurable resource paths
‚îÇ
‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îú‚îÄ‚îÄ common.css                  # Global styles, CSS variables
‚îÇ   ‚îú‚îÄ‚îÄ components-shared.css       # NEW: Shared component patterns
‚îÇ   ‚îî‚îÄ‚îÄ playground.css              # Page layout styles
‚îÇ
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ _base/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ base-component.js       # NEW: Base class for all components
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ stats-toolbar/              # REFACTORED (Phase 1)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stats-toolbar.js        # Slim JS - extends BaseComponent
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stats-toolbar.html      # NEW: External template
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stats-toolbar.css       # NEW: Extracted styles
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ url-input/                  # REFACTORED (Phase 1)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ url-input.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ url-input.html          # NEW
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ url-input.css           # NEW
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ config-panel/               # REFACTORED (Phase 2)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config-panel.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config-panel.html       # NEW
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config-panel.css        # NEW
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ html-input/                 # REFACTORED (Phase 2)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ html-input.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ html-input.html         # NEW
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ html-input.css          # NEW
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ graph-canvas/               # REFACTORED (Phase 2)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ graph-canvas.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ graph-canvas.html       # NEW
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ graph-canvas.css        # NEW
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ top-nav/                    # REFACTORED (Phase 2)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ top-nav.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ top-nav.html            # NEW
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ top-nav.css             # NEW
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ dot-renderer/               # REFACTORED (Phase 3)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dot-renderer.js         # Uses DotParser
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ vis-renderer/               # REFACTORED (Phase 3)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vis-renderer.js         # Uses DotParser
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ d3-renderer/                # REFACTORED (Phase 3)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ d3-renderer.js          # Uses DotParser
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ cytoscape-renderer/         # REFACTORED (Phase 3)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cytoscape-renderer.js   # Uses DotParser
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ mermaid-renderer/           # REFACTORED (Phase 3)
‚îÇ       ‚îî‚îÄ‚îÄ mermaid-renderer.js     # Uses DotParser
‚îÇ
‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api-client.js           # Unchanged
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ helpers.js              # NEW: Shared utility functions
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dot-parser.js           # NEW: Shared DOT parsing
‚îÇ   ‚îî‚îÄ‚îÄ playground.js               # Orchestrator (minor updates)
‚îÇ
‚îî‚îÄ‚îÄ samples/
    ‚îî‚îÄ‚îÄ *.html                      # Unchanged
```

---

## 4. Implementation Phases

### Phase 1: Foundation + 2 Pilot Components
**Components**: `stats-toolbar`, `url-input`  
**Why these?**: Medium complexity, good variety of patterns (forms, events, state)

**Deliverables**:
1. `config/component-paths.js` - Resource path configuration
2. `components/_base/base-component.js` - Base class
3. `js/utils/helpers.js` - Shared utilities
4. `css/components-shared.css` - Shared component CSS
5. Refactored `stats-toolbar` (js, html, css)
6. Refactored `url-input` (js, html, css)
7. Updated `playground.html` to load new resources

**Validation**: Playground works identically to v0.2.0

### Phase 2: Remaining UI Components
**Components**: `config-panel`, `html-input`, `graph-canvas`, `top-nav`

**Deliverables**:
1. Refactored components following Phase 1 patterns
2. Any additional shared CSS patterns discovered
3. Any additional BaseComponent methods needed

### Phase 3: Renderer Components + DotParser
**Components**: All 5 renderers

**Deliverables**:
1. `js/utils/dot-parser.js` - Shared DOT parsing
2. Refactored renderers using DotParser
3. Renderers extend BaseComponent where beneficial

---

## 5. Detailed Specifications

### 5.1 Component Paths Configuration

```javascript
// config/component-paths.js

const ComponentPaths = {
    // Base path for all component resources
    // Can be overridden in v0.2.x for different deployment scenarios
    basePath: '/console/v0/v0.2/v0.2.1',
    
    // Returns paths for a component's resources
    getComponentPaths(componentName) {
        const base = `${this.basePath}/components/${componentName}`;
        return {
            js: `${base}/${componentName}.js`,
            css: `${base}/${componentName}.css`,
            html: `${base}/${componentName}.html`
        };
    },
    
    // Shared resources
    sharedCss: {
        components: '/console/v0/v0.2/v0.2.1/css/components-shared.css'
    },
    
    // Utility scripts
    utils: {
        helpers: '/console/v0/v0.2/v0.2.1/js/utils/helpers.js',
        dotParser: '/console/v0/v0.2/v0.2.1/js/utils/dot-parser.js'
    }
};

// Freeze to prevent accidental modification
Object.freeze(ComponentPaths);
window.ComponentPaths = ComponentPaths;
```

### 5.2 BaseComponent Class

```javascript
// components/_base/base-component.js

class BaseComponent extends HTMLElement {
    constructor() {
        super();
        this.attachShadow({ mode: 'open' });
        this._eventListeners = [];
        this._isReady = false;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Lifecycle
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    async connectedCallback() {
        await this.loadResources();
        this.setupEventListeners();
        this._isReady = true;
        this.emit('component-ready', { component: this.tagName.toLowerCase() });
    }

    disconnectedCallback() {
        this.cleanup();
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Resource Loading
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    async loadResources() {
        const componentName = this.tagName.toLowerCase();
        const paths = ComponentPaths.getComponentPaths(componentName);
        
        // Load shared CSS + component CSS + template in parallel
        const [sharedCss, componentCss, templateHtml] = await Promise.all([
            this.fetchText(ComponentPaths.sharedCss.components),
            this.fetchText(paths.css).catch(() => ''), // Optional
            this.fetchText(paths.html)
        ]);
        
        // Inject into shadow DOM
        this.shadowRoot.innerHTML = `
            <style>${sharedCss}</style>
            <style>${componentCss}</style>
            ${templateHtml}
        `;
        
        // Allow subclass to do post-load initialization
        this.onResourcesLoaded();
    }
    
    async fetchText(url) {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`Failed to load: ${url}`);
        return response.text();
    }
    
    // Override in subclass for post-load setup
    onResourcesLoaded() {}
    
    // Override in subclass
    setupEventListeners() {}

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Event Utilities
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    // Add event listener with automatic cleanup tracking
    on(element, event, handler, options = {}) {
        const boundHandler = handler.bind(this);
        element.addEventListener(event, boundHandler, options);
        this._eventListeners.push({ element, event, handler: boundHandler, options });
    }
    
    // Emit custom event (bubbles through shadow DOM)
    emit(eventName, detail = {}) {
        this.dispatchEvent(new CustomEvent(eventName, {
            detail,
            bubbles: true,
            composed: true  // Crosses shadow DOM boundary
        }));
    }
    
    // Cleanup all tracked listeners
    cleanup() {
        this._eventListeners.forEach(({ element, event, handler, options }) => {
            element.removeEventListener(event, handler, options);
        });
        this._eventListeners = [];
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Query Helpers (within shadow DOM)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    $(selector) {
        return this.shadowRoot.querySelector(selector);
    }
    
    $$(selector) {
        return this.shadowRoot.querySelectorAll(selector);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Formatting Utilities (from helpers.js, exposed for convenience)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    escapeHtml(text) {
        return Helpers.escapeHtml(text);
    }
    
    formatNumber(num) {
        return Helpers.formatNumber(num);
    }
    
    formatBytes(bytes) {
        return Helpers.formatBytes(bytes);
    }
}

window.BaseComponent = BaseComponent;
```

### 5.3 Helpers Utility Module

```javascript
// js/utils/helpers.js

const Helpers = {
    escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    },
    
    formatNumber(num) {
        if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
        if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
        return num.toString();
    },
    
    formatBytes(bytes) {
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    },
    
    // Debounce utility for input handlers
    debounce(fn, delay) {
        let timeoutId;
        return function(...args) {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => fn.apply(this, args), delay);
        };
    },
    
    // Color manipulation
    darkenColor(hex, amount = 30) {
        const color = hex.replace('#', '');
        const r = Math.max(0, parseInt(color.substr(0, 2), 16) - amount);
        const g = Math.max(0, parseInt(color.substr(2, 2), 16) - amount);
        const b = Math.max(0, parseInt(color.substr(4, 2), 16) - amount);
        return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
    },
    
    lightenColor(hex, amount = 30) {
        const color = hex.replace('#', '');
        const r = Math.min(255, parseInt(color.substr(0, 2), 16) + amount);
        const g = Math.min(255, parseInt(color.substr(2, 2), 16) + amount);
        const b = Math.min(255, parseInt(color.substr(4, 2), 16) + amount);
        return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
    }
};

Object.freeze(Helpers);
window.Helpers = Helpers;
```

### 5.4 DotParser Utility Class

```javascript
// js/utils/dot-parser.js

class DotParser {
    /**
     * Parse DOT code and return nodes and edges
     * @param {string} dotCode - DOT language string
     * @returns {{nodes: Array, edges: Array}}
     */
    static parse(dotCode) {
        const nodes = [];
        const edges = [];
        const nodeMap = new Map();

        // Extract node definitions
        const nodeRegex = /"([^"]+)"\s*\[([^\]]+)\]/g;
        let match;

        while ((match = nodeRegex.exec(dotCode)) !== null) {
            const nodeId = match[1];
            const attrs = match[2];
            
            if (attrs.includes('->')) continue;

            const label = this.extractAttr(attrs, 'label') || nodeId;
            const fillcolor = this.extractAttr(attrs, 'fillcolor') || '#f5f5f5';
            const fontcolor = this.extractAttr(attrs, 'fontcolor') || '#333333';
            const shape = this.extractAttr(attrs, 'shape') || 'box';
            
            const nodeType = this.detectNodeType(label, fillcolor);

            nodes.push({
                id: nodeId,
                label: this.cleanLabel(label),
                rawLabel: label,
                fillcolor,
                fontcolor,
                shape,
                nodeType,
                borderColor: Helpers.darkenColor(fillcolor)
            });

            nodeMap.set(nodeId, true);
        }

        // Extract edges
        const edgeRegex = /"([^"]+)"\s*->\s*"([^"]+)"(?:\s*\[([^\]]*)\])?/g;

        while ((match = edgeRegex.exec(dotCode)) !== null) {
            const source = match[1];
            const target = match[2];
            const attrs = match[3] || '';

            if (nodeMap.has(source) && nodeMap.has(target)) {
                edges.push({
                    source,
                    target,
                    id: `${source}-${target}`,
                    style: this.extractAttr(attrs, 'style'),
                    color: this.extractAttr(attrs, 'color') || '#888888',
                    dashed: this.extractAttr(attrs, 'style') === 'dashed'
                });
            }
        }

        return { nodes, edges };
    }

    /**
     * Extract attribute value from DOT attribute string
     */
    static extractAttr(attrString, attrName) {
        const patterns = [
            new RegExp(`${attrName}="([^"]*)"`, 'i'),
            new RegExp(`${attrName}=([^,\\]\\s]+)`, 'i')
        ];

        for (const pattern of patterns) {
            const match = attrString.match(pattern);
            if (match) {
                return match[1].replace(/\\"/g, '"').replace(/\\n/g, '\n');
            }
        }
        return null;
    }

    /**
     * Clean label text for display
     */
    static cleanLabel(label) {
        return label
            .replace(/\\n/g, '\n')
            .replace(/\\"/g, '"')
            .replace(/^"(.*)"$/, '$1');
    }

    /**
     * Detect node type from label and color
     */
    static detectNodeType(label, color) {
        if (label.startsWith('<') && label.endsWith('>')) return 'tag';
        if (label.includes('=')) return 'attribute';
        if (color === '#FFFACD' || color === '#fffacd') return 'text';
        return 'element';
    }

    /**
     * Truncate label for compact display
     */
    static truncateLabel(label, maxLength = 20) {
        if (label.length <= maxLength) return label;
        return label.substring(0, maxLength - 3) + '...';
    }
}

window.DotParser = DotParser;
```

### 5.5 Shared Component CSS

```css
/* css/components-shared.css */

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   Shared Component Styles
   Used by all components via Shadow DOM injection
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* Import CSS variables from common.css via host context */
:host {
    display: block;
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Panel Pattern
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.panel-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-bottom: var(--spacing-sm, 10px);
    border-bottom: 1px solid var(--color-border, #ddd);
    margin-bottom: var(--spacing-sm, 10px);
}

.panel-title {
    font-size: 1.1em;
    font-weight: 600;
    color: var(--color-text-primary, #333);
    display: flex;
    align-items: center;
    gap: var(--spacing-xs, 5px);
}

.panel-title-icon {
    font-size: 1.2em;
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Card Pattern
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.card {
    background: var(--color-bg-card, #ffffff);
    border-radius: var(--radius-md, 10px);
    box-shadow: var(--shadow-md, 0 4px 6px rgba(0,0,0,0.1));
    padding: var(--spacing-md, 20px);
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Toolbar Pattern
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.toolbar {
    display: flex;
    align-items: center;
    gap: var(--spacing-md, 20px);
    padding: var(--spacing-sm, 10px) var(--spacing-md, 20px);
    background: var(--color-bg-muted, #f7f7f7);
    border-radius: var(--radius-sm, 5px);
}

.toolbar-left,
.toolbar-right {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm, 10px);
}

.toolbar-right {
    margin-left: auto;
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Button Styles
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-xs, 5px);
    padding: var(--spacing-sm, 10px) var(--spacing-md, 20px);
    border: none;
    border-radius: var(--radius-sm, 5px);
    font-family: var(--font-primary, system-ui, sans-serif);
    font-size: 1em;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm, 0 2px 4px rgba(0,0,0,0.1));
}

.btn:active:not(:disabled) {
    transform: translateY(0);
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.btn-primary {
    background: var(--gradient-bg, linear-gradient(135deg, #667eea 0%, #764ba2 100%));
    color: white;
}

.btn-secondary {
    background: var(--color-bg-muted, #f7f7f7);
    color: var(--color-text-primary, #333);
    border: 1px solid var(--color-border, #ddd);
}

.btn-sm {
    padding: var(--spacing-xs, 5px) var(--spacing-sm, 10px);
    font-size: 0.9em;
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Form Controls
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.form-control {
    width: 100%;
    padding: var(--spacing-sm, 10px);
    border: 1px solid var(--color-border, #ddd);
    border-radius: var(--radius-sm, 5px);
    font-family: var(--font-primary, system-ui, sans-serif);
    font-size: 1em;
    transition: border-color 0.2s ease;
}

.form-control:focus {
    outline: none;
    border-color: var(--color-primary, #667eea);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

textarea.form-control {
    font-family: var(--font-code, 'Courier New', monospace);
    resize: vertical;
    min-height: 100px;
}

.form-check {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm, 10px);
    margin-bottom: var(--spacing-sm, 10px);
}

.form-check input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.form-check label {
    cursor: pointer;
    user-select: none;
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Loading & Error States
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-md, 20px);
    color: var(--color-text-secondary, #666);
}

.spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 2px solid var(--color-border, #ddd);
    border-top-color: var(--color-primary, #667eea);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.error-banner {
    display: none;
    padding: var(--spacing-sm, 10px) var(--spacing-md, 20px);
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: var(--radius-sm, 5px);
    color: var(--color-error, #ef4444);
    font-size: 0.9em;
}

.error-banner.show {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-sm, 10px);
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Badge Pattern
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 10px;
    background: var(--color-bg-muted, #f7f7f7);
    border-radius: 15px;
    font-size: 0.85em;
}

.badge-label {
    color: var(--color-text-muted, #999);
}

.badge-value {
    font-weight: 600;
    color: var(--color-text-primary, #333);
}

.badge.highlight {
    background: rgba(102, 126, 234, 0.1);
}

.badge.highlight .badge-value {
    color: var(--color-primary, #667eea);
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Selector Pattern
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.selector {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm, 10px);
}

.selector label {
    font-size: 0.9em;
    color: var(--color-text-secondary, #666);
}

.selector select {
    padding: var(--spacing-xs, 5px) var(--spacing-sm, 10px);
    border: 1px solid var(--color-border, #ddd);
    border-radius: var(--radius-sm, 5px);
    font-size: 0.9em;
    background: white;
    cursor: pointer;
}
```

### 5.6 Example Refactored Component: stats-toolbar

**stats-toolbar.js** (Slim):
```javascript
// components/stats-toolbar/stats-toolbar.js

class StatsToolbar extends BaseComponent {
    constructor() {
        super();
        this.stats = { 
            total_nodes: 0, total_edges: 0, element_nodes: 0, 
            attr_nodes: 0, text_nodes: 0 
        };
        this.timing = { 
            api_ms: 0, server_ms: 0, render_ms: 0, dot_size: 0 
        };
    }

    onResourcesLoaded() {
        // Cache element references after template loads
        this.elements = {
            renderBtn: this.$('#render-btn'),
            statNodes: this.$('#stat-nodes'),
            statEdges: this.$('#stat-edges'),
            statElements: this.$('#stat-elements'),
            statAttrs: this.$('#stat-attrs'),
            statText: this.$('#stat-text'),
            timingApi: this.$('#timing-api'),
            timingServer: this.$('#timing-server'),
            timingRender: this.$('#timing-render'),
            timingDotSize: this.$('#timing-dot-size'),
            errorBanner: this.$('#error-banner'),
            errorTitle: this.$('#error-title'),
            errorDetail: this.$('#error-detail'),
            errorHint: this.$('#error-hint')
        };
    }

    setupEventListeners() {
        this.on(this.elements.renderBtn, 'click', this.handleRenderClick);
    }

    handleRenderClick() {
        this.emit('render-requested');
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Public API
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    setStats(stats) {
        this.stats = { ...this.stats, ...stats };
        this.elements.statNodes.textContent = this.formatNumber(this.stats.total_nodes);
        this.elements.statEdges.textContent = this.formatNumber(this.stats.total_edges);
        this.elements.statElements.textContent = this.formatNumber(this.stats.element_nodes);
        this.elements.statAttrs.textContent = this.formatNumber(this.stats.attr_nodes);
        this.elements.statText.textContent = this.formatNumber(this.stats.text_nodes);
    }

    setTiming(timing) {
        this.timing = { ...this.timing, ...timing };
        this.elements.timingApi.textContent = timing.api_ms ? `${timing.api_ms}ms` : '-';
        this.elements.timingServer.textContent = timing.server_ms ? `${timing.server_ms}ms` : '-';
        this.elements.timingRender.textContent = timing.render_ms ? `${timing.render_ms}ms` : '-';
        this.elements.timingDotSize.textContent = timing.dot_size ? this.formatBytes(timing.dot_size) : '-';
    }

    setRenderingState(rendering) {
        this.elements.renderBtn.disabled = rendering;
        this.elements.renderBtn.innerHTML = rendering
            ? '<span class="spinner"></span> Rendering...'
            : 'üîÑ Render Graph';
    }

    showError(title, detail, hint = '') {
        this.elements.errorTitle.textContent = title;
        this.elements.errorDetail.textContent = detail;
        this.elements.errorHint.textContent = hint;
        this.elements.errorBanner.classList.add('show');
    }

    hideError() {
        this.elements.errorBanner.classList.remove('show');
    }

    clearStats() {
        this.stats = { total_nodes: 0, total_edges: 0, element_nodes: 0, attr_nodes: 0, text_nodes: 0 };
        this.timing = { api_ms: 0, server_ms: 0, render_ms: 0, dot_size: 0 };
        
        ['statNodes', 'statEdges', 'statElements', 'statAttrs', 'statText',
         'timingApi', 'timingServer', 'timingRender', 'timingDotSize'].forEach(key => {
            this.elements[key].textContent = '-';
        });
        
        this.hideError();
    }
}

customElements.define('stats-toolbar', StatsToolbar);
```

**stats-toolbar.html**:
```html
<!-- components/stats-toolbar/stats-toolbar.html -->

<div class="stats-toolbar">
    <div class="stats-toolbar-row">
        <button id="render-btn" class="btn btn-primary">
            üîÑ Render Graph
        </button>
        <div class="stats-group">
            <div class="badge highlight">
                <span class="badge-label">Nodes:</span>
                <span class="badge-value" id="stat-nodes">0</span>
            </div>
            <div class="badge highlight">
                <span class="badge-label">Edges:</span>
                <span class="badge-value" id="stat-edges">0</span>
            </div>
            <div class="badge">
                <span class="badge-label">Elements:</span>
                <span class="badge-value" id="stat-elements">0</span>
            </div>
            <div class="badge">
                <span class="badge-label">Attrs:</span>
                <span class="badge-value" id="stat-attrs">0</span>
            </div>
            <div class="badge">
                <span class="badge-label">Text:</span>
                <span class="badge-value" id="stat-text">0</span>
            </div>
        </div>
    </div>
    
    <div class="stats-toolbar-row">
        <div class="timing-group">
            <div class="timing-item">
                <span>üì° API:</span>
                <span class="timing-value" id="timing-api">-</span>
            </div>
            <div class="timing-item">
                <span>‚öôÔ∏è Server:</span>
                <span class="timing-value" id="timing-server">-</span>
            </div>
            <div class="timing-item">
                <span>üé® Render:</span>
                <span class="timing-value" id="timing-render">-</span>
            </div>
            <div class="timing-item">
                <span>üì¶ DOT:</span>
                <span class="timing-value" id="timing-dot-size">-</span>
            </div>
        </div>
    </div>
    
    <div id="error-banner" class="error-banner">
        <span class="error-icon">‚ö†Ô∏è</span>
        <div class="error-content">
            <div class="error-title" id="error-title">Error</div>
            <div class="error-detail" id="error-detail"></div>
            <div class="error-hint" id="error-hint"></div>
        </div>
    </div>
</div>
```

**stats-toolbar.css**:
```css
/* components/stats-toolbar/stats-toolbar.css */

/* Component-specific styles only */
.stats-toolbar {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm, 10px);
    padding: var(--spacing-md, 20px);
    background: white;
    border-radius: var(--radius-md, 10px);
    box-shadow: var(--shadow-sm, 0 2px 4px rgba(0,0,0,0.1));
}

.stats-toolbar-row {
    display: flex;
    align-items: center;
    gap: var(--spacing-md, 20px);
    flex-wrap: wrap;
}

.stats-group {
    display: flex;
    align-items: center;
    gap: var(--spacing-md, 20px);
    flex: 1;
    flex-wrap: wrap;
}

.timing-group {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm, 10px);
    font-size: 0.8em;
    color: var(--color-text-muted, #999);
}

.timing-item {
    display: flex;
    align-items: center;
    gap: 3px;
}

.timing-value {
    font-weight: 500;
    color: var(--color-text-secondary, #666);
}

.error-content {
    flex: 1;
}

.error-title {
    font-weight: 600;
    margin-bottom: 2px;
}

.error-detail {
    font-size: 0.9em;
    opacity: 0.8;
}

.error-hint {
    margin-top: var(--spacing-xs, 5px);
    font-size: 0.85em;
    color: var(--color-text-secondary, #666);
}
```

---

## 6. Script Loading Order in playground.html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graph Playground v0.2.1</title>

    <!-- Global styles -->
    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/playground.css">
</head>
<body>
    <div class="playground">
        <!-- Components used here -->
        <top-nav></top-nav>
        <main class="playground-main">
            <div class="left-panel">
                <url-input></url-input>
                <html-input></html-input>
                <config-panel></config-panel>
            </div>
            <div class="right-panel">
                <stats-toolbar></stats-toolbar>
                <graph-canvas></graph-canvas>
            </div>
        </main>
    </div>

    <!-- Hidden renderers -->
    <dot-renderer style="display: none;"></dot-renderer>
    <vis-renderer style="display: none;"></vis-renderer>
    <d3-renderer style="display: none;"></d3-renderer>
    <cytoscape-renderer style="display: none;"></cytoscape-renderer>
    <mermaid-renderer style="display: none;"></mermaid-renderer>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         Script Loading Order (Critical)
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    
    <!-- 1. Configuration (paths for resources) -->
    <script src="./config/component-paths.js"></script>
    
    <!-- 2. Utilities (used by BaseComponent and components) -->
    <script src="./js/utils/helpers.js"></script>
    <script src="./js/utils/dot-parser.js"></script>
    
    <!-- 3. Base Component (must load before all components) -->
    <script src="./components/_base/base-component.js"></script>
    
    <!-- 4. Services -->
    <script src="./js/services/api-client.js"></script>
    
    <!-- 5. UI Components -->
    <script src="./components/top-nav/top-nav.js"></script>
    <script src="./components/url-input/url-input.js"></script>
    <script src="./components/html-input/html-input.js"></script>
    <script src="./components/config-panel/config-panel.js"></script>
    <script src="./components/stats-toolbar/stats-toolbar.js"></script>
    <script src="./components/graph-canvas/graph-canvas.js"></script>
    
    <!-- 6. Renderer Components -->
    <script src="./components/dot-renderer/dot-renderer.js"></script>
    <script src="./components/vis-renderer/vis-renderer.js"></script>
    <script src="./components/d3-renderer/d3-renderer.js"></script>
    <script src="./components/cytoscape-renderer/cytoscape-renderer.js"></script>
    <script src="./components/mermaid-renderer/mermaid-renderer.js"></script>
    
    <!-- 7. Page Orchestrator (last) -->
    <script src="./js/playground.js"></script>
</body>
</html>
```

---

## 7. Testing Strategy

### 7.1 After Phase 1 Completion
1. **Load playground.html** - should display without errors
2. **Verify component rendering** - stats-toolbar and url-input appear correctly
3. **Test interactions**:
   - Click "Render Graph" - emits event
   - Enter URL - fetch works
   - All stat displays update correctly
4. **Check Shadow DOM** - components have isolated styles
5. **Verify no console errors**

### 7.2 After Phase 2 Completion
1. **Full workflow test**:
   - Load sample HTML
   - Modify config
   - Render graph
   - View stats
2. **Test all renderers work**
3. **Verify event propagation through Shadow DOM**

### 7.3 After Phase 3 Completion
1. **Test DotParser with various DOT inputs**
2. **Test each renderer produces identical output to v0.2.0**
3. **Performance check** - resource loading shouldn't add noticeable delay

---

## 8. Migration Notes for Implementing LLM

### 8.1 Key Differences from v0.2.0
- Components use Shadow DOM (encapsulated)
- Events need `composed: true` to cross shadow boundary
- CSS variables must be accessible through `:host` context
- Template/CSS loaded async - component ready after `component-ready` event

### 8.2 Potential Issues to Watch For
1. **CSS Variables Inheritance**: Ensure `common.css` variables reach into Shadow DOM
2. **Event Bubbling**: Events must use `composed: true` for cross-shadow propagation
3. **FOUC (Flash of Unstyled Content)**: Consider hiding components until ready
4. **Fetch Failures**: Handle missing CSS/HTML gracefully

### 8.3 Rollback Plan
If Phase 1 reveals fundamental issues:
- Document issues in v0.2.1 notes
- Create v0.2.2 with alternative approach
- v0.2.0 remains stable fallback

---

## 9. Summary

**v0.2.1 Goal**: Establish component architecture patterns that enable rapid iteration in v0.2.x

**Key Deliverables**:
1. `BaseComponent` class with resource loading and utilities
2. `DotParser` shared utility
3. `Helpers` shared utility  
4. `components-shared.css` with common patterns
5. All components refactored to external CSS/HTML

**Success Metric**: Components are 50-70% smaller, CSS/HTML changes require no JS modifications

**Phase 1 Focus**: `stats-toolbar` + `url-input` to validate architecture before full rollout
