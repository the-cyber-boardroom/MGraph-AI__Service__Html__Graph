# Dev Brief: v0.2.0 Consolidation

**Project**: MGraph HTML Graph Render UI  
**Task**: Consolidate v0.1.x (v0.1.0 → v0.1.4) into self-contained v0.2.0  
**Date**: December 2024  
**IFD Version**: Following v1.2.0 guidelines

---

## 1. Executive Summary

### Objective
Create a **completely self-contained** v0.2.0 folder by merging all proven code from the v0.1.x minor version series. No functional changes—pure consolidation.

### Key Principle
> "What was tested IS what ships."

v0.2.0 must behave **identically** to v0.1.4. The only differences are:
- All files local (no cross-version imports)
- Version strings updated
- Internal paths updated to be self-referential

---

## 2. Why Consolidation is Needed

### Current State: v0.1.x Link-Back Structure

The v0.1.x series uses IFD's link-back pattern where each minor version references earlier versions:

```
v0.1.4/playground.html loads:
├── ../v0.1.0/css/common.css
├── ../v0.1.1/css/playground.css
├── ../v0.1.0/js/services/api-client.js
├── ../v0.1.1/components/top-nav/top-nav.js
├── ../v0.1.1/components/html-input/html-input.js
├── ../v0.1.2/components/dot-renderer/dot-renderer.js
├── ../v0.1.3/components/url-input/url-input.js
├── ./components/graph-canvas/graph-canvas.js  (override)
├── ./components/vis-renderer/vis-renderer.js  (new)
└── ./js/playground.js
```

**Benefits during development**: Changes are isolated, easy rollback, clear history.

**Problems for deployment**:
- Complex dependency chain
- Breaking changes in v0.1.1 would affect v0.1.2, v0.1.3, v0.1.4
- Not suitable as a stable release baseline

### Target State: v0.2.0 Self-Contained Structure

```
v0.2.0/playground.html loads:
├── ./css/common.css
├── ./css/playground.css
├── ./js/services/api-client.js
├── ./components/top-nav/top-nav.js
├── ./components/html-input/html-input.js
├── ./components/dot-renderer/dot-renderer.js
├── ./components/url-input/url-input.js
├── ./components/graph-canvas/graph-canvas.js
├── ./components/vis-renderer/vis-renderer.js
└── ./js/playground.js
```

**Result**: Complete isolation. v0.2.0 can be deployed, copied, or modified without affecting v0.1.x.

---

## 3. Source File Analysis

### 3.1 Components: Origin Mapping

| Component | Source Version | Notes |
|-----------|----------------|-------|
| `config-panel` | v0.1.1 | Full component, no overrides |
| `graph-canvas` | v0.1.4 | **Override** - replaces v0.1.1 version |
| `html-input` | v0.1.1 | Full component, no overrides |
| `stats-panel` | v0.1.1 | Full component, no overrides |
| `top-nav` | v0.1.1 | Full component, no overrides |
| `dot-renderer` | v0.1.2 | New in v0.1.2 |
| `stats-toolbar` | v0.1.3 | New in v0.1.3 |
| `url-input` | v0.1.3 | New in v0.1.3 |
| `cytoscape-renderer` | v0.1.4 | New in v0.1.4 |
| `d3-renderer` | v0.1.4 | New in v0.1.4 |
| `mermaid-renderer` | v0.1.4 | New in v0.1.4 |
| `vis-renderer` | v0.1.4 | New in v0.1.4 |

### 3.2 CSS Files: Merge Required

**playground.css** requires merging from three versions:

| Version | Content Type |
|---------|--------------|
| v0.1.1 | Base playground layout (~180 lines) |
| v0.1.3 | Layout overrides for stats-toolbar positioning (~50 lines) |
| v0.1.4 | Renderer-specific styles (~70 lines) |

**Merge Strategy**: Since CSS cascades, we concatenate in order: v0.1.1 → v0.1.3 → v0.1.4. Later rules override earlier ones, preserving intended behavior.

**common.css** and **dashboard.css**: Direct copy from v0.1.0 (no overrides exist).

### 3.3 JavaScript Files: Origin Mapping

| File | Source Version | Notes |
|------|----------------|-------|
| `js/services/api-client.js` | v0.1.0 | Foundation, no overrides |
| `js/dashboard.js` | v0.1.0 | Foundation, no overrides |
| `js/playground.js` | v0.1.4 | **Full file** (not surgical override) |

**Important Note on playground.js**: 

The v0.1.x series did NOT use surgical overrides for playground.js. Each version (v0.1.1, v0.1.2, v0.1.3, v0.1.4) contains a complete file. We take v0.1.4's version as it represents the final state.

This is a deviation from ideal IFD practice (which would have small surgical overrides), but we consolidate what exists, not what should have been.

### 3.4 HTML Files

| File | Source Version | Changes Required |
|------|----------------|------------------|
| `index.html` | v0.1.4 | Update version strings, fix paths |
| `playground.html` | v0.1.4 | Update version strings, fix all paths to be local |
| `404.html` | v0.1.0 | Update path in back link |

### 3.5 Static Assets

| Folder | Source Version | Notes |
|--------|----------------|-------|
| `samples/` | v0.1.0 | 5 HTML sample files, no changes |

---

## 4. Consolidation Rules

### 4.1 What MUST Change

**Version Strings**: Update all references from `v0.1.x` to `v0.2.0`:
- HTML title tags
- Code comments (file headers)
- UI-displayed version numbers
- Console.log statements

**Import Paths**: Convert cross-version references to local:
- `../v0.1.0/css/common.css` → `./css/common.css`
- `../v0.1.1/components/...` → `./components/...`

**File Headers**: Update version comments in each file:
```javascript
// Before: v0.1.4 - Multiple Rendering Engines
// After:  v0.2.0 - Consolidated from v0.1.x
```

### 4.2 What MUST NOT Change

**Functionality**: Zero logic changes. If v0.1.4 has a bug, v0.2.0 has the same bug.

**API Contracts**: All CustomEvents, method signatures, and component APIs remain identical.

**External Dependencies**: Same CDN URLs for viz-js, vis.js, d3, cytoscape, mermaid.

**CSS Class Names**: No renaming, no restructuring.

**HTML Structure**: Component templates remain byte-for-byte identical (except version strings).

---

## 5. Detailed File Plan

### 5.1 Directory Structure

```
v0.2.0/
├── components/
│   ├── config-panel/
│   │   └── config-panel.js
│   ├── cytoscape-renderer/
│   │   └── cytoscape-renderer.js
│   ├── d3-renderer/
│   │   └── d3-renderer.js
│   ├── dot-renderer/
│   │   └── dot-renderer.js
│   ├── graph-canvas/
│   │   └── graph-canvas.js
│   ├── html-input/
│   │   └── html-input.js
│   ├── mermaid-renderer/
│   │   └── mermaid-renderer.js
│   ├── stats-panel/
│   │   └── stats-panel.js
│   ├── stats-toolbar/
│   │   └── stats-toolbar.js
│   ├── top-nav/
│   │   └── top-nav.js
│   ├── url-input/
│   │   └── url-input.js
│   └── vis-renderer/
│       └── vis-renderer.js
├── css/
│   ├── common.css
│   ├── dashboard.css
│   └── playground.css          ← MERGED
├── js/
│   ├── dashboard.js
│   ├── playground.js
│   └── services/
│       └── api-client.js
├── samples/
│   ├── attributes.html
│   ├── bootstrap.html
│   ├── mixed-content.html
│   ├── nested.html
│   └── simple.html
├── tests/
│   ├── index.html
│   ├── test-paths.js
│   └── test-utils.js
├── 404.html
├── index.html
├── playground.html
├── karma.conf.cjs
├── package.json
└── wallaby.cjs
```

**Total**: 31 files (excluding tests co-located with components, which come in Phase 2)

### 5.2 Special Handling Cases

#### Case A: CSS Merge (playground.css)

Three source files must be merged in order:

1. **v0.1.1/css/playground.css** - Base layout
2. **v0.1.3/css/playground.css** - Stats toolbar positioning
3. **v0.1.4/css/playground.css** - Renderer-specific styles

Merge approach: Concatenate with section headers for traceability:

```css
/* ═══════════════════════════════════════════════════════════════
   MGraph HTML Graph - Render UI - Playground Styles
   v0.2.0 - Consolidated from v0.1.x
   ═══════════════════════════════════════════════════════════════ */

/* ─────────────────────────────────────────────────────────────────
   Base Layout (from v0.1.1)
   ───────────────────────────────────────────────────────────────── */
[v0.1.1 content here]

/* ─────────────────────────────────────────────────────────────────
   Stats Toolbar Layout (from v0.1.3)
   ───────────────────────────────────────────────────────────────── */
[v0.1.3 content here]

/* ─────────────────────────────────────────────────────────────────
   Renderer Styles (from v0.1.4)
   ───────────────────────────────────────────────────────────────── */
[v0.1.4 content here]
```

#### Case B: graph-canvas Override

v0.1.1 has the original graph-canvas.js (basic, only DOT renderer enabled).
v0.1.4 has a complete replacement (all 5 renderers enabled).

**Decision**: Take v0.1.4 version only. It's a full replacement, not a patch.

#### Case C: playground.js Evolution

Each version has a complete file:
- v0.1.1: ~150 lines (basic)
- v0.1.2: ~170 lines (adds viz-js)
- v0.1.3: ~250 lines (adds URL handling, timing)
- v0.1.4: ~316 lines (adds multi-renderer support)

**Decision**: Take v0.1.4 version only. It contains all functionality.

#### Case D: HTML Sample Path in html-input.js

The html-input component has a hardcoded path for loading samples:

```javascript
// Current (in v0.1.1):
const response = await fetch(`/console/v0/v0.1/v0.1.0/samples/${sampleName}.html`);

// Required for v0.2.0:
const response = await fetch(`/console/v0/v0.2/v0.2.0/samples/${sampleName}.html`);
```

This is a **path update**, not a functional change.

#### Case E: Test Path Configuration

The test infrastructure needs path updates:

**test-paths.js**: Use the v0.2.0 template provided, which changes all paths to local.

**karma.conf.cjs**: Update base path from `v0.1` to `v0.2`.

**wallaby.cjs**: Update file patterns for v0.2.0 structure.

**package.json**: Update version to `0.2.0`.

---

## 6. Path Update Reference

### 6.1 HTML Files: Script/Link Updates

**playground.html** path changes:

| From | To |
|------|----|
| `../v0.1.0/css/common.css` | `./css/common.css` |
| `../v0.1.1/css/playground.css` | `./css/playground.css` |
| `../v0.1.0/js/services/api-client.js` | `./js/services/api-client.js` |
| `../v0.1.1/components/top-nav/top-nav.js` | `./components/top-nav/top-nav.js` |
| `../v0.1.1/components/html-input/html-input.js` | `./components/html-input/html-input.js` |
| `../v0.1.1/components/config-panel/config-panel.js` | `./components/config-panel/config-panel.js` |
| `../v0.1.1/components/graph-canvas/graph-canvas.js` | (removed - v0.1.4 override used) |
| `../v0.1.2/components/dot-renderer/dot-renderer.js` | `./components/dot-renderer/dot-renderer.js` |
| `../v0.1.3/components/url-input/url-input.js` | `./components/url-input/url-input.js` |
| `../v0.1.3/components/stats-toolbar/stats-toolbar.js` | `./components/stats-toolbar/stats-toolbar.js` |
| `./components/graph-canvas/graph-canvas.js` | `./components/graph-canvas/graph-canvas.js` |
| `./components/vis-renderer/vis-renderer.js` | `./components/vis-renderer/vis-renderer.js` |
| `./components/d3-renderer/d3-renderer.js` | `./components/d3-renderer/d3-renderer.js` |
| `./components/cytoscape-renderer/cytoscape-renderer.js` | `./components/cytoscape-renderer/cytoscape-renderer.js` |
| `./components/mermaid-renderer/mermaid-renderer.js` | `./components/mermaid-renderer/mermaid-renderer.js` |
| `./js/playground.js` | `./js/playground.js` |

### 6.2 JavaScript Files: Internal Path Updates

**top-nav.js**: Update navigation links
```javascript
// From:
href="./index.html"  // relative to v0.1.1
// To:
href="./index.html"  // relative to v0.2.0 (same, but in different folder)
```

**html-input.js**: Update sample fetch path
```javascript
// From:
fetch(`/console/v0/v0.1/v0.1.0/samples/${sampleName}.html`)
// To:
fetch(`/console/v0/v0.2/v0.2.0/samples/${sampleName}.html`)
```

### 6.3 Index Pages: Version Links

**index.html** (dashboard): Update "Previous Versions" section to include v0.1.x links pointing to `../v0.1/v0.1.x/`.

---

## 7. Validation Checklist

After consolidation, verify:

### 7.1 Structural Validation
- [ ] All 31 files present in v0.2.0/
- [ ] No files reference `../v0.1.x/` paths
- [ ] No orphan files (everything reachable from index.html or playground.html)

### 7.2 Functional Validation
- [ ] index.html loads without console errors
- [ ] playground.html loads without console errors
- [ ] Sample selector works (fetches from local samples/)
- [ ] URL fetch works
- [ ] All 5 renderers appear in dropdown
- [ ] DOT renderer produces output
- [ ] vis.js renderer produces output
- [ ] D3 renderer produces output
- [ ] Cytoscape renderer produces output
- [ ] Mermaid renderer produces output
- [ ] Stats toolbar updates on render
- [ ] Config panel changes trigger re-render
- [ ] Zoom controls work
- [ ] Download button works

### 7.3 Version String Validation
- [ ] Browser title shows "v0.2.0"
- [ ] Dashboard header shows "v0.2.0"
- [ ] Console logs show "v0.2.0"
- [ ] No "v0.1" strings in code (except historical references in comments)

---

## 8. Out of Scope (Phase 2)

The following are explicitly NOT part of this consolidation:

1. **Test files** - Will be consolidated separately after v0.2.0 source is validated
2. **Bug fixes** - Any bugs discovered are documented but not fixed
3. **Refactoring** - Code structure remains as-is from v0.1.4
4. **New features** - Zero new functionality
5. **Performance improvements** - No optimization

---

## 9. Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Path typo breaks loading | Medium | High | Systematic search/replace, validation checklist |
| CSS merge order wrong | Low | Medium | Clear section headers, visual testing |
| Missed version string | Medium | Low | grep for "v0.1" after completion |
| Sample path breaks | Medium | Medium | Test sample loading explicitly |

---

## 10. Success Criteria

v0.2.0 is complete when:

1. **Isolation**: Folder can be copied anywhere and still works (no external v0.1.x dependencies)
2. **Parity**: Behavior is identical to v0.1.4
3. **Clean**: No console errors, no 404s, no broken references
4. **Versioned**: All visible version strings show "v0.2.0"

---

## Appendix A: File Count Summary

| Category | Count |
|----------|-------|
| Components | 12 files |
| CSS | 3 files |
| JavaScript | 3 files |
| HTML pages | 3 files |
| Samples | 5 files |
| Test infrastructure | 3 files |
| Config files | 3 files |
| **Total** | **32 files** |

---

## Appendix B: Component Feature Matrix

| Component | Events Emitted | Events Listened | External Libs |
|-----------|---------------|-----------------|---------------|
| config-panel | `config-changed` | - | - |
| graph-canvas | `renderer-changed` | - | - |
| html-input | `html-changed` | - | - |
| stats-panel | - | - | - |
| stats-toolbar | `render-requested` | - | - |
| top-nav | - | - | - |
| url-input | `url-html-fetched` | - | - |
| dot-renderer | - | - | viz-js (CDN) |
| vis-renderer | - | - | vis-network (CDN) |
| d3-renderer | - | - | d3 (CDN) |
| cytoscape-renderer | - | - | cytoscape + dagre (CDN) |
| mermaid-renderer | - | - | mermaid (CDN) |

---

*End of Dev Brief*
