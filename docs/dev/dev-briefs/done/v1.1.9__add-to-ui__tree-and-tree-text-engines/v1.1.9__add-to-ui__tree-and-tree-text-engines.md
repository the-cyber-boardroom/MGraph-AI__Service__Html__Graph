# Brief Add to ui : tree and tree_text engines

*Backend Brief for Frontend LLM - v0.2.9*

**version**: v1.1.9

## Summary of Changes

Backend has added **two new rendering engines** to the graph conversion API:

| Engine | Purpose | Output Type |
|--------|---------|-------------|
| `tree` | Hierarchical JSON tree structure | JSON object |
| `tree_text` | Formatted text representation | String |

These provide alternative views of the HTML graph that emphasize the hierarchical DOM structure rather than the full graph topology.

---

## New Endpoints

### Tree (JSON Structure)

```
POST /graph/from/html/to/tree/{transformation}
POST /graph/from/url/to/tree/{transformation}
```

**Response:**
```javascript
{
    "tree": {
        "id": "c0000001",
        "value": "c0000001",
        "children": {
            "tag": [
                { "id": "c0000002", "value": "div", "children": {} }
            ],
            "attr": [
                { "id": "c0000003", "value": "main", "children": {} },
                { "id": "c0000004", "value": "content", "children": {} }
            ],
            "text": [
                { "id": "c0000005", "value": "Hello World", "children": {} }
            ],
            "child": [
                {
                    "id": "c0000010",
                    "value": "c0000010",
                    "children": {
                        "tag": [...],
                        "text": [...]
                    }
                }
            ]
        }
    },
    "rootId": "c0000001",
    "stats": { ... },              // Same Stats object as other endpoints
    "duration": 0.0023,
    "format": "tree",
    "transformation": "default"
}
```

### Tree Text (Formatted String)

```
POST /graph/from/html/to/tree_text/{transformation}
POST /graph/from/url/to/tree_text/{transformation}
```

**Response:**
```javascript
{
    "tree_text": "c0000001\n    tag:\n        div\n    attr:\n        main\n        content\n    text:\n        Hello World",
    "tree_text_size": 78,
    "rootId": "c0000001",
    "stats": { ... },              // Same Stats object as other endpoints
    "duration": 0.0019,
    "format": "tree_text",
    "transformation": "default"
}
```

---

## Request Format

Same as all other graph endpoints:

```javascript
{
    "html": "<div class='main'>Hello World</div>",
    "preset": "FULL_DETAIL",       // "FULL_DETAIL" | "STRUCTURE_ONLY" | "MINIMAL"
    "show_tag_nodes": true,
    "show_attr_nodes": true,
    "show_text_nodes": true,
    "color_scheme": "DEFAULT"      // "DEFAULT" | "MONOCHROME" | "HIGH_CONTRAST"
}
```

---

## Tree Structure Details

### Node Object

Each node in the tree has:

| Field | Type | Description |
|-------|------|-------------|
| `id` | string | Unique node identifier |
| `value` | string | Display value (tag name, attribute value, text content, or node ID for elements) |
| `children` | object | Child nodes grouped by predicate type |

### Children Object

Children are grouped by their relationship type (predicate):

| Key | Description |
|-----|-------------|
| `tag` | Tag name nodes (e.g., "div", "p", "span") |
| `attr` | Attribute value nodes |
| `text` | Text content nodes |
| `child` | Child element nodes (nested DOM elements) |

**Note:** Not all keys will be present - only those with actual children.

### Example Tree for `<div class="main"><p>Hello</p></div>`

```javascript
{
    "id": "root-div",
    "value": "root-div",
    "children": {
        "tag": [{ "id": "t1", "value": "div", "children": {} }],
        "attr": [{ "id": "a1", "value": "main", "children": {} }],
        "child": [
            {
                "id": "child-p",
                "value": "child-p",
                "children": {
                    "tag": [{ "id": "t2", "value": "p", "children": {} }],
                    "text": [{ "id": "x1", "value": "Hello", "children": {} }]
                }
            }
        ]
    }
}
```

---

## Tree Text Format Details

The text format uses indentation to show hierarchy:

```
{root_id}
    tag:
        {tag_name}
    attr:
        {attr_value_1}
        {attr_value_2}
    text:
        {text_content}
    child:
        {child_id}
            tag:
                {child_tag}
            text:
                {child_text}
```

- **Indentation:** 4 spaces per level
- **Grouping:** Children grouped under predicate labels (`tag:`, `attr:`, `text:`, `child:`)
- **Recursion:** Child elements are fully expanded inline

---

## Frontend Implementation Suggestions

### 1. Add to Engine Selector

Update the engine dropdown to include:
```javascript
{ value: 'tree', label: 'Tree (JSON)' },
{ value: 'tree_text', label: 'Tree (Text)' }
```

### 2. Tree Renderer Component

For the `tree` engine, consider:

**Option A: Collapsible Tree View**
- Use a recursive component to render nested nodes
- Expand/collapse functionality for child elements
- Color-code by predicate type (tag=blue, attr=purple, text=yellow)

**Option B: Indented List**
- Simple hierarchical list with CSS indentation
- Hover to highlight related nodes

### 3. Tree Text Renderer Component

For `tree_text`, display as:

```html
<pre class="tree-text-output">{tree_text}</pre>
```

With optional:
- Monospace font
- Syntax highlighting for predicate labels
- Copy-to-clipboard button

### 4. Handling Empty Trees

If `tree` is an empty object `{}`, show a "No tree data" message.

### 5. Stats Display

Both endpoints return the same `stats` object - can reuse existing stats display component.

---

## Updated Engine Type Enum

```javascript
const ENGINE_TYPES = [
    'dot',
    'visjs',
    'd3',
    'cytoscape',
    'mermaid',
    'tree',       // NEW
    'tree_text'   // NEW
];
```

---

## Testing Examples

### Minimal HTML
```javascript
// Request
{ "html": "<p>Test</p>" }

// tree_text response
"c0000001\n    tag:\n        p\n    text:\n        Test"
```

### Nested HTML
```javascript
// Request
{ "html": "<div><h1>Title</h1><p>Text</p></div>" }

// tree_text response (formatted for readability)
c0000001
    tag:
        div
    child:
        c0000002
            tag:
                h1
            text:
                Title
        c0000003
            tag:
                p
            text:
                Text
```

---

## Coordination Notes

- Both new engines support all existing transformations (`default`, `body_only`, `elements_only`, `collapse_text`, etc.)
- Response structure follows same pattern as other engines: `{ data, stats, duration, format, transformation }`
- No new request parameters - uses same `Schema__Graph__From_Html__Request`