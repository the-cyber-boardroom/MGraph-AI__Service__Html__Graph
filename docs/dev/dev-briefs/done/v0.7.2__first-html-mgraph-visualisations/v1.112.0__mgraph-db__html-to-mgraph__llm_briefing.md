# HTML→MGraph: Technical Implementation Guide

**LLM Briefing Document**  
**Focus**: Complete technical specification for HTML-to-Graph conversion system
**Version**: v1.112.0 (MyFeeds-AI)

---

## Document Purpose

This briefing provides a **complete technical specification** of the HTML→MGraph conversion system implemented in MyFeeds-AI. This system converts HTML documents into semantic graph representations suitable for:

- **Analysis**: Understand document structure and relationships
- **Visualization**: Create visual representations of HTML structure
- **Querying**: Navigate documents using graph traversal
- **Comparison**: Diff documents at the structural level
- **Transformation**: Manipulate structure before rendering

**Target Audience**: Developers refactoring this into a standalone library

**Prerequisites**: Familiarity with HTML/DOM, graph theory, MGraph-DB basics

---

## 1. Architecture Overview

### System Components

```
┌─────────────────────────────────────────────────────────────────┐
│                         HTML Document                            │
│                    (HTML string or file)                         │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Html__To__Html_Dict                           │
│              (HTML string → Python dict)                         │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                 Html_Dict__To__Html_Document                     │
│         (Python dict → Schema__Html_Document)                    │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│              Html_Document__To__Html_MGraph                      │
│         (Schema__Html_Document → Html_MGraph)                    │
│                                                                  │
│  Two conversion modes:                                           │
│  1. Full Mode: Complete graph with all HTML structure           │
│  2. Schema Mode: Simplified graph showing unique elements       │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Html_MGraph                                 │
│              (MGraph with HTML-specific extensions)              │
│                                                                  │
│  Features:                                                       │
│  - Typed nodes (40+ HTML element types)                         │
│  - Typed edges (relationship types)                             │
│  - Screenshot generation with theming                           │
│  - Tree view export                                             │
└─────────────────────────────────────────────────────────────────┘
```

### Core Classes

1. **Schema__Html_Document**: Type-safe representation of HTML structure
2. **Html_MGraph**: MGraph subclass with HTML-specific methods
3. **Html_Document__To__Html_MGraph**: Full conversion (all structure)
4. **Html_Document__To__Html_MGraph__Schema**: Schema conversion (unique elements)
5. **Html_MGraph__Screenshot**: Visualization with theming

---

## 2. HTML Schema System

### Schema__Html_Document

The foundation of the system - a type-safe representation of HTML:

```python
from osbot_utils.type_safe.Type_Safe import Type_Safe

class Schema__Html_Document(Type_Safe):
    """Root document representation"""
    root_node: Schema__Html_Node

class Schema__Html_Node(Type_Safe):
    """HTML element node"""
    tag: str                        # Element tag (e.g., 'div', 'span')
    attributes: Dict[str, str]      # Element attributes
    nodes: List[Union[              # Child nodes
        'Schema__Html_Node',        # Nested elements
        Schema__Html_Node__Data     # Text/comment/other data
    ]]

class Schema__Html_Node__Data(Type_Safe):
    """Non-element content (text, comments, etc.)"""
    type: Schema__Html_Node__Data__Type
    data: str

class Schema__Html_Node__Data__Type(Enum):
    """Type of non-element content"""
    TEXT = 'text'
    COMMENT = 'comment'
    CDATA = 'cdata'
```

### Example: HTML to Schema Conversion

```html
<div class="container">
    <p>Hello <span>World</span></p>
</div>
```

Becomes:

```python
Schema__Html_Document(
    root_node=Schema__Html_Node(
        tag='div',
        attributes={'class': 'container'},
        nodes=[
            Schema__Html_Node(
                tag='p',
                attributes={},
                nodes=[
                    Schema__Html_Node__Data(
                        type=Schema__Html_Node__Data__Type.TEXT,
                        data='Hello '
                    ),
                    Schema__Html_Node(
                        tag='span',
                        attributes={},
                        nodes=[
                            Schema__Html_Node__Data(
                                type=Schema__Html_Node__Data__Type.TEXT,
                                data='World'
                            )
                        ]
                    )
                ]
            )
        ]
    )
)
```

---

## 3. MGraph Node and Edge Types

### 3.1 Node Type System

The system defines **40+ typed node classes** for HTML elements:

```python
from mgraph_db.mgraph.schemas.Schema__MGraph__Node__Value import Schema__MGraph__Node__Value

# Base class for all HTML nodes
class Schema__Html_MGraph__Node__HTML__BASE(Schema__MGraph__Node__Value):
    pass

# Document structure nodes
class Schema__Html_MGraph__Node__HTML__HTML(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__HEAD(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__BODY(Schema__MGraph__Node__Value): pass

# Text and content nodes
class Schema__Html_MGraph__Node__HTML__P(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__H1(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__H2(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__H3(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__SPAN(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__TEXT(Schema__MGraph__Node__Value): pass

# Structural nodes
class Schema__Html_MGraph__Node__HTML__DIV(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__SECTION(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__ARTICLE(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__NAV(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__HEADER(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__FOOTER(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__MAIN(Schema__MGraph__Node__Value): pass

# Interactive nodes
class Schema__Html_MGraph__Node__HTML__A(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__BUTTON(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__INPUT(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__FORM(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__LABEL(Schema__MGraph__Node__Value): pass

# List nodes
class Schema__Html_MGraph__Node__HTML__UL(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__LI(Schema__MGraph__Node__Value): pass

# Table nodes
class Schema__Html_MGraph__Node__HTML__TABLE(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__TR(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__TD(Schema__MGraph__Node__Value): pass

# Media nodes
class Schema__Html_MGraph__Node__HTML__IMG(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__SVG(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__IFRAME(Schema__MGraph__Node__Value): pass

# Head elements
class Schema__Html_MGraph__Node__HTML__TITLE(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__META(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__LINK(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__SCRIPT(Schema__MGraph__Node__Value): pass
class Schema__Html_MGraph__Node__HTML__STYLE(Schema__MGraph__Node__Value): pass

# ... and more
```

### 3.2 Node Type Mapping

```python
HTML__NODES_TYPES__FOR__TAG = {
    'html'    : Schema__Html_MGraph__Node__HTML__HTML,
    'head'    : Schema__Html_MGraph__Node__HTML__HEAD,
    'body'    : Schema__Html_MGraph__Node__HTML__BODY,
    'div'     : Schema__Html_MGraph__Node__HTML__DIV,
    'p'       : Schema__Html_MGraph__Node__HTML__P,
    'span'    : Schema__Html_MGraph__Node__HTML__SPAN,
    'a'       : Schema__Html_MGraph__Node__HTML__A,
    'h1'      : Schema__Html_MGraph__Node__HTML__H1,
    'h2'      : Schema__Html_MGraph__Node__HTML__H2,
    'h3'      : Schema__Html_MGraph__Node__HTML__H3,
    'ul'      : Schema__Html_MGraph__Node__HTML__UL,
    'li'      : Schema__Html_MGraph__Node__HTML__LI,
    'table'   : Schema__Html_MGraph__Node__HTML__TABLE,
    'tr'      : Schema__Html_MGraph__Node__HTML__TR,
    'td'      : Schema__Html_MGraph__Node__HTML__TD,
    'img'     : Schema__Html_MGraph__Node__HTML__IMG,
    'button'  : Schema__Html_MGraph__Node__HTML__BUTTON,
    'input'   : Schema__Html_MGraph__Node__HTML__INPUT,
    'form'    : Schema__Html_MGraph__Node__HTML__FORM,
    'nav'     : Schema__Html_MGraph__Node__HTML__NAV,
    'header'  : Schema__Html_MGraph__Node__HTML__HEADER,
    'footer'  : Schema__Html_MGraph__Node__HTML__FOOTER,
    'section' : Schema__Html_MGraph__Node__HTML__SECTION,
    'article' : Schema__Html_MGraph__Node__HTML__ARTICLE,
    'main'    : Schema__Html_MGraph__Node__HTML__MAIN,
    # ... 40+ total mappings
}
```

### 3.3 Edge Type System

Edges represent parent-child relationships with typing:

```python
from mgraph_db.mgraph.schemas.Schema__MGraph__Edge import Schema__MGraph__Edge

class Schema__Html_MGraph__Edge__HTML__BODY(Schema__MGraph__Edge): pass
class Schema__Html_MGraph__Edge__HTML__HEAD(Schema__MGraph__Edge): pass
class Schema__Html_MGraph__Edge__HTML__HTML(Schema__MGraph__Edge): pass
class Schema__Html_MGraph__Edge__HTML__TEXT(Schema__MGraph__Edge): pass
class Schema__Html_MGraph__Edge__HTML__DIV(Schema__MGraph__Edge): pass
class Schema__Html_MGraph__Edge__HTML__P(Schema__MGraph__Edge): pass
# ... etc

HTML__EDGES_TYPES__FOR__TAG = {
    'body'  : Schema__Html_MGraph__Edge__HTML__BODY,
    'head'  : Schema__Html_MGraph__Edge__HTML__HEAD,
    'html'  : Schema__Html_MGraph__Edge__HTML__HTML,
    'text'  : Schema__Html_MGraph__Edge__HTML__TEXT,
    'div'   : Schema__Html_MGraph__Edge__HTML__DIV,
    'p'     : Schema__Html_MGraph__Edge__HTML__P,
    # ... etc
}
```

---

## 4. Conversion Implementation

### 4.1 Full Conversion Mode

Creates a complete graph with all HTML structure including text nodes:

```python
class Html_Document__To__Html_MGraph(Type_Safe):
    html_document: Schema__Html_Document = None
    html_mgraph: Html_MGraph
    
    def convert(self) -> Html_MGraph:
        target_node = self.html_document.root_node
        self.build_mgraph__from__html_node(target_node=target_node)
        return self.html_mgraph
    
    def build_mgraph__from__html_node(self, target_node: Schema__Html_Node):
        with self.html_mgraph.builder() as _:
            node_tag = target_node.tag
            node_type = self.resolve_node_type_from_node_tag(node_tag)
            
            # Add the element node
            _.add_node(node_tag, key=Obj_Id(), node_type=node_type)
            
            # Process children
            for node in target_node.nodes:
                if type(node) is Schema__Html_Node:
                    # Child element
                    edge_type = self.resolve_edge_type_from_node_tag(node.tag)
                    child_node = self.build_mgraph__from__html_node(node)
                    _.connect_to(target=child_node.node_id, edge_type=edge_type)
                    _.up()
                    
                elif type(node) is Schema__Html_Node__Data:
                    # Text node
                    if node.type == Schema__Html_Node__Data__Type.TEXT:
                        node_data = self.resolve_node_data(node)
                        _.add_node(
                            node_data,
                            key=Obj_Id(),
                            node_type=Schema__Html_MGraph__Node__HTML__TEXT
                        )
                        text_node = _.current_node()
                        _.up()
                        _.connect_to(
                            text_node.node_id,
                            edge_type=Schema__Html_MGraph__Edge__HTML__TEXT
                        )
            
            _.up()
            return _.current_node()
    
    def resolve_node_type_from_node_tag(self, node_tag):
        return HTML__NODES_TYPES__FOR__TAG.get(node_tag, None)
    
    def resolve_edge_type_from_node_tag(self, node_tag):
        return HTML__EDGES_TYPES__FOR__TAG.get(node_tag, None)
    
    def resolve_node_data(self, node: Schema__Html_Node__Data):
        """Format text node data (truncate if too long)"""
        node_data = node.data
        node_data_size = len(node_data)
        return f"({node_data_size})"  # Show size, not content
```

### 4.2 Schema Conversion Mode

Creates a simplified graph showing unique element types (no text, no duplicates):

```python
class Html_Document__To__Html_MGraph__Schema(Type_Safe):
    html_document: Schema__Html_Document = None
    html_mgraph: Html_MGraph
    
    def convert(self):
        target_node = self.html_document.root_node
        self.build_mgraph__with__html_schema(target_node=target_node)
        return self.html_mgraph
    
    def build_mgraph__with__html_schema(self, target_node: Schema__Html_Node):
        with self.html_mgraph.builder() as _:
            _.add_node(target_node.tag)
            
            for node in target_node.nodes:
                if type(node) is Schema__Html_Node:
                    # Recursively process child
                    self.build_mgraph__with__html_schema(node)
                    
                    # Connect with unique_link=True (no duplicate edges)
                    _.connect_to(node.tag, unique_link=True)
                    _.up()
```

**Key difference**: 
- Full mode: Every instance of `<div>` creates a new node
- Schema mode: Only one `div` node, showing it exists in the structure

### 4.3 Usage Example

```python
# Parse HTML
from osbot_utils.helpers.html.Html__To__Html_Dict import Html__To__Html_Dict
from osbot_utils.helpers.html.Html_Dict__To__Html_Document import Html_Dict__To__Html_Document

html = """
<html>
    <head><title>Test</title></head>
    <body>
        <div><p>Hello <span>World</span></p></div>
    </body>
</html>
"""

# Convert to schema
html_dict = Html__To__Html_Dict(html=html).convert()
html_document = Html_Dict__To__Html_Document(html__dict=html_dict).convert()

# Convert to graph (full mode)
html_mgraph_full = Html_MGraph()
converter_full = Html_Document__To__Html_MGraph(
    html_document=html_document,
    html_mgraph=html_mgraph_full
)
converter_full.convert()

# Convert to graph (schema mode)
html_mgraph_schema = Html_MGraph()
converter_schema = Html_Document__To__Html_MGraph__Schema(
    html_document=html_document,
    html_mgraph=html_mgraph_schema
)
converter_schema.convert()
```

---

## 5. Html_MGraph Class

### 5.1 Class Definition

```python
from mgraph_db.mgraph.MGraph import MGraph

class Html_MGraph(MGraph):
    """MGraph subclass with HTML-specific extensions"""
    
    def html_mgraph__screenshot(self):
        """Get screenshot helper with HTML theming"""
        return Html_MGraph__Screenshot(html_mgraph=self)
    
    def node__html(self):
        """Get the root HTML node"""
        return self.values().get_by_value(value='html', value_type=str)
```

### 5.2 Screenshot Helper

```python
class Html_MGraph__Screenshot(Type_Safe):
    html_mgraph: MGraph
    png_bytes: bytes = None
    
    def create(self, config: Schema__Html_MGraph__Screenshot__Config = None):
        if not config:
            config = Schema__Html_MGraph__Screenshot__Config()
        
        with self.html_mgraph.screenshot() as _:
            with _.export().export_dot() as dot:
                # Configure graph layout
                if config.graph.layout_engine:
                    dot.set_graph__layout_engine(config.graph.layout_engine.value)
                if config.graph.spring_constant:
                    dot.set_graph__spring_constant(config.graph.spring_constant)
                
                dot.set_graph__rank_sep(config.graph.rank_sep)
                dot.set_graph__node_sep(config.graph.node_sep)
                dot.set_graph__margin(config.graph.margin)
                
                # Set graph title
                if config.graph.title:
                    dot.set_graph__title(config.graph.title)
                    dot.set_graph__title__font__size(config.graph.title_font_size)
                    dot.set_graph__title__font__color(config.graph.title_font_color)
                
                dot.set_graph__background__color(config.graph.bg_color)
                dot.show_node__value()
                
                # Apply per-node-type styling
                for node_type, node_config in HTML_MGRAPH__NODES__CONFIG.items():
                    cfg = config.get_node_config(node_type)
                    
                    if cfg.fill_color:
                        dot.set_node__type_fill_color(node_type, cfg.fill_color)
                    if cfg.font_color:
                        dot.set_node__type_font_color(node_type, cfg.font_color)
                    if cfg.shape:
                        dot.set_node__type_shape(node_type, cfg.shape)
                    if cfg.style:
                        dot.set_node__type_style(node_type, cfg.style)
                    if cfg.font_size:
                        dot.set_node__type_font_size(node_type, cfg.font_size)
                    if cfg.font_name:
                        dot.set_node__type_font_name(node_type, cfg.font_name)
            
            _.save_to(target_file=config.target_file)
            self.png_bytes = _.dot(print_dot_code=config.print_dot_code)
            return self.png_bytes
```

---

## 6. Theming System (Overview)

The theming system is detailed in briefing v1.3.3, but here's the integration:

### 6.1 Node Configuration

```python
class Schema__Html_MGraph__Config__Node(Type_Safe):
    """Base configuration for node styling"""
    fill_color: str = None
    font_color: str = None
    shape: str = None
    style: str = None
    font_size: int = None
    font_name: str = None
```

### 6.2 Per-Element Styling

```python
# Example: HTML element styling
class Html_MGraph__Config__Node__HTML(Schema__Html_MGraph__Config__Node):
    fill_color: str = '#1E88E5'  # Blue
    shape: str = "hexagon"
    font_size: int = 50

class Html_MGraph__Config__Node__DIV(Schema__Html_MGraph__Config__Node):
    fill_color: str = '#BDBDBD'  # Gray
    shape: str = "box"

class Html_MGraph__Config__Node__P(Html_MGraph__Config__Node__White_Text):
    fill_color: str = '#9C27B0'  # Purple
    shape: str = "note"
```

### 6.3 Configuration Mapping

```python
HTML_MGRAPH__NODES__CONFIG: Dict[Type, Schema__Html_MGraph__Config__Node] = {
    Schema__Html_MGraph__Node__HTML__HTML: Html_MGraph__Config__Node__HTML(),
    Schema__Html_MGraph__Node__HTML__DIV: Html_MGraph__Config__Node__DIV(),
    Schema__Html_MGraph__Node__HTML__P: Html_MGraph__Config__Node__P(),
    # ... 40+ mappings
}
```

---

## 7. Tree View Export

### 7.1 Export Tree Values

```python
class Html_Document__To__Html_MGraph__Schema:
    def tree_values(self):
        html_node = self.html_mgraph.node__html()
        if html_node:
            with self.html_mgraph.export().export_tree_values(show_predicate=False) as _:
                return _.as_text(root_nodes_ids=[html_node.node_id])
```

### 7.2 Example Output

For HTML structure:
```html
<html>
  <head><title>Test</title></head>
  <body>
    <div><p>Hello</p></div>
  </body>
</html>
```

Tree view output:
```
html
├── head
│   └── title
└── body
    └── div
        └── p
```

---

## 8. Advanced Features

### 8.1 Graph Querying

```python
# Find all divs
with html_mgraph.query() as _:
    _.add().add_nodes_with_type(Schema__Html_MGraph__Node__HTML__DIV)
    div_nodes = _.mgraph_view.nodes()

# Find body and its children (depth 2)
with html_mgraph.query() as _:
    _.add().add_nodes_with_type(Schema__Html_MGraph__Node__HTML__BODY)
    _.add_outgoing_edges__with_depth(2)
    body_subgraph = _.export_view()
```

### 8.2 View Extraction

```python
class Html_MGraph__View__Page_Structure(Type_Safe):
    html_mgraph: Html_MGraph
    create_png: bool = False
    
    def create_using_mquery(self):
        with self.html_mgraph.query() as _:
            # Get body node
            _.add().add_nodes_with_type(Schema__Html_MGraph__Node__HTML__BODY)
            
            # Get children (depth 2)
            _.add_outgoing_edges__with_depth(2)
            
            # Export as new graph
            mgraph_view = _.export_view()
            return mgraph_view
```

### 8.3 Diff Analysis

```python
# Compare two HTML documents
html_mgraph_1 = convert_html_to_mgraph(html_1)
html_mgraph_2 = convert_html_to_mgraph(html_2)

with html_mgraph_1.diff(html_mgraph_2) as diff:
    added_nodes = diff.added_nodes()
    removed_nodes = diff.removed_nodes()
    modified_nodes = diff.modified_nodes()
```

---

## 9. Refactoring Considerations

### 9.1 Standalone Library Structure

```
html-mgraph/
├── html_mgraph/
│   ├── __init__.py
│   ├── core/
│   │   ├── html_mgraph.py           # Html_MGraph class
│   │   ├── converter.py             # Conversion logic
│   │   └── converter_schema.py      # Schema conversion
│   ├── schemas/
│   │   ├── nodes.py                 # Node type definitions
│   │   ├── edges.py                 # Edge type definitions
│   │   └── config.py                # Configuration schemas
│   ├── visualization/
│   │   ├── screenshot.py            # Screenshot generation
│   │   ├── themes.py                # Theming system
│   │   └── colors.py                # Color definitions
│   ├── query/
│   │   ├── selectors.py             # CSS-like selectors
│   │   └── traversal.py             # Graph traversal
│   └── utils/
│       ├── html_parser.py           # HTML parsing utilities
│       └── node_mapping.py          # Tag→Type mappings
├── tests/
├── examples/
├── docs/
├── setup.py
└── README.md
```

### 9.2 API Design

```python
# Simple API
from html_mgraph import HtmlMGraph

# Parse and convert
graph = HtmlMGraph.from_html("<html>...</html>")

# Or from file
graph = HtmlMGraph.from_file("page.html")

# Or from URL
graph = HtmlMGraph.from_url("https://example.com")

# Query
divs = graph.find_all("div")
body = graph.find_one("body")

# Export
tree_text = graph.export_tree()
png_bytes = graph.export_png(theme="default")
dot_code = graph.export_dot()

# Diff
diff = graph.diff(other_graph)
print(diff.summary())
```

### 9.3 Dependencies

```python
# setup.py
install_requires = [
    'mgraph-db>=1.0',           # Core graph database
    'beautifulsoup4>=4.9',      # HTML parsing
    'osbot-utils>=1.0',         # Type-safe utilities
    'graphviz>=0.19',           # Visualization (optional)
]

extras_require = {
    'dev': ['pytest', 'pytest-cov', 'black', 'mypy'],
    'visualization': ['graphviz', 'pillow'],
}
```

### 9.4 Configuration System

```python
from dataclasses import dataclass
from typing import Optional

@dataclass
class HtmlMGraphConfig:
    """Configuration for HTML→MGraph conversion"""
    
    # Conversion options
    include_text_nodes: bool = True
    include_comments: bool = False
    max_text_length: Optional[int] = None
    
    # Node filtering
    exclude_tags: List[str] = None
    include_tags: List[str] = None
    
    # Visualization defaults
    default_theme: str = "default"
    layout_engine: str = "dot"
    
    # Performance
    cache_enabled: bool = True
    parallel_processing: bool = False

# Usage
config = HtmlMGraphConfig(
    include_text_nodes=False,
    exclude_tags=['script', 'style']
)
graph = HtmlMGraph.from_html(html, config=config)
```

---

## 10. Testing Strategy

### 10.1 Unit Tests

```python
def test_simple_html_conversion():
    html = "<html><body><div>Test</div></body></html>"
    graph = HtmlMGraph.from_html(html)
    
    assert graph.node_count() == 4  # html, body, div, text
    assert graph.edge_count() == 3
    
    body = graph.find_one("body")
    assert body is not None
    assert len(graph.children(body)) == 1

def test_node_type_mapping():
    html = "<div><p><span>Text</span></p></div>"
    graph = HtmlMGraph.from_html(html)
    
    div_nodes = graph.find_all_by_type(Schema__Html_MGraph__Node__HTML__DIV)
    assert len(div_nodes) == 1
    
    span_nodes = graph.find_all_by_type(Schema__Html_MGraph__Node__HTML__SPAN)
    assert len(span_nodes) == 1
```

### 10.2 Integration Tests

```python
def test_complex_html_structure():
    html = load_fixture("complex_page.html")
    graph = HtmlMGraph.from_html(html)
    
    # Verify structure
    assert graph.find_one("html") is not None
    assert len(graph.find_all("div")) > 10
    
    # Test querying
    nav = graph.find_one("nav")
    links = graph.find_all("a", parent=nav)
    assert len(links) > 0
    
    # Test export
    tree = graph.export_tree()
    assert "html" in tree
    assert "body" in tree
```

### 10.3 Performance Tests

```python
def test_large_html_performance():
    html = generate_large_html(nodes=10000)
    
    start = time.time()
    graph = HtmlMGraph.from_html(html)
    conversion_time = time.time() - start
    
    assert conversion_time < 5.0  # Should convert in <5 seconds
    assert graph.node_count() == 10000

def test_screenshot_generation_performance():
    graph = create_medium_graph(nodes=1000)
    
    start = time.time()
    png_bytes = graph.export_png()
    generation_time = time.time() - start
    
    assert generation_time < 10.0  # Should generate in <10 seconds
    assert len(png_bytes) > 0
```

---

## 11. Documentation Requirements

### 11.1 API Documentation

Every public method needs comprehensive docstrings:

```python
class HtmlMGraph:
    def find_all(self, tag: str, **kwargs) -> List[Node]:
        """
        Find all nodes matching the given tag.
        
        Args:
            tag: HTML tag name (e.g., 'div', 'p', 'span')
            **kwargs: Additional filters
                - class_name: Filter by CSS class
                - id: Filter by element ID
                - attrs: Filter by attributes dict
                - parent: Limit search to children of this node
        
        Returns:
            List of matching nodes
        
        Examples:
            >>> graph = HtmlMGraph.from_html("<div class='container'>...</div>")
            >>> divs = graph.find_all('div')
            >>> containers = graph.find_all('div', class_name='container')
        
        Raises:
            ValueError: If tag name is invalid
        """
```

### 11.2 Usage Examples

Create comprehensive examples for common use cases:

```python
# examples/01_basic_conversion.py
"""Basic HTML to graph conversion"""
from html_mgraph import HtmlMGraph

html = """
<html>
    <head><title>Example</title></head>
    <body>
        <div class="content">
            <h1>Hello World</h1>
            <p>This is a paragraph.</p>
        </div>
    </body>
</html>
"""

graph = HtmlMGraph.from_html(html)
print(f"Nodes: {graph.node_count()}")
print(f"Edges: {graph.edge_count()}")

# examples/02_querying.py
"""Querying HTML graphs"""
from html_mgraph import HtmlMGraph

graph = HtmlMGraph.from_file("page.html")

# Find all paragraphs
paragraphs = graph.find_all("p")
print(f"Found {len(paragraphs)} paragraphs")

# Find specific div
content_div = graph.find_one("div", class_name="content")
if content_div:
    children = graph.children(content_div)
    print(f"Content div has {len(children)} children")

# examples/03_visualization.py
"""Visualizing HTML structure"""
from html_mgraph import HtmlMGraph

graph = HtmlMGraph.from_html("<html>...</html>")

# Export as tree
tree_text = graph.export_tree()
print(tree_text)

# Export as PNG
png_bytes = graph.export_png(
    theme="default",
    layout="dot",
    title="Page Structure"
)

with open("structure.png", "wb") as f:
    f.write(png_bytes)
```

---

## 12. Migration Path

### 12.1 Extract from MyFeeds-AI

Steps to extract this code into a standalone library:

1. **Copy core files**:
   - `html_to_mgraph/*.py`
   - `schemas/Schema__Html_MGraph__*.py`
   
2. **Remove dependencies on MyFeeds-AI**:
   - Replace `Hacker_News__File` with generic file handling
   - Remove S3-specific storage logic
   - Extract theming system (see v1.3.3)

3. **Refactor imports**:
   ```python
   # Before
   from myfeeds_ai.mgraphs.html_to_mgraph.Html_MGraph import Html_MGraph
   
   # After
   from html_mgraph import HtmlMGraph
   ```

4. **Add standalone tests**:
   - Port existing tests
   - Add new integration tests
   - Add performance benchmarks

5. **Create example gallery**:
   - Basic conversion
   - Complex pages
   - Querying examples
   - Visualization examples
   - Diff analysis

### 12.2 Backward Compatibility

To maintain compatibility with MyFeeds-AI:

```python
# In MyFeeds-AI, create adapter
from html_mgraph import HtmlMGraph as HtmlMGraph_Standalone
from myfeeds_ai.files import MyFeeds_File

class Html_MGraph(HtmlMGraph_Standalone):
    """MyFeeds-AI adapter for HtmlMGraph"""
    
    def save_to_myfeeds(self, file: MyFeeds_File):
        """Save using MyFeeds storage system"""
        json_data = self.json__compress()
        file.save_data(json_data)
    
    @classmethod
    def load_from_myfeeds(cls, file: MyFeeds_File):
        """Load from MyFeeds storage system"""
        json_data = file.load()
        return cls.from_json__compressed(json_data)
```

---

## 13. Performance Optimization

### 13.1 Lazy Loading

```python
class HtmlMGraph:
    def __init__(self):
        self._nodes_cache = None
        self._edges_cache = None
    
    @property
    def nodes(self):
        """Lazy load nodes"""
        if self._nodes_cache is None:
            self._nodes_cache = self._load_nodes()
        return self._nodes_cache
```

### 13.2 Parallel Processing

```python
def convert_large_html(html: str, parallel: bool = True):
    """Convert large HTML documents using parallel processing"""
    if parallel and len(html) > 100000:
        # Split HTML into chunks
        chunks = split_html_by_sections(html)
        
        # Process in parallel
        with ThreadPoolExecutor(max_workers=4) as executor:
            graphs = executor.map(convert_chunk, chunks)
        
        # Merge results
        return merge_graphs(graphs)
    else:
        return convert_html(html)
```

### 13.3 Caching

```python
from functools import lru_cache

class HtmlMGraph:
    @lru_cache(maxsize=128)
    def find_all(self, tag: str):
        """Cached node lookup"""
        return self._find_all_uncached(tag)
```

---

## 14. Error Handling

### 14.1 Graceful Degradation

```python
def convert_html_safe(html: str) -> Optional[HtmlMGraph]:
    """Convert HTML with error handling"""
    try:
        return HtmlMGraph.from_html(html)
    except MalformedHTMLError as e:
        logger.warning(f"Malformed HTML: {e}")
        # Try to fix common issues
        fixed_html = fix_common_html_issues(html)
        try:
            return HtmlMGraph.from_html(fixed_html)
        except:
            logger.error("Could not fix HTML")
            return None
    except Exception as e:
        logger.error(f"Unexpected error: {e}")
        return None
```

### 14.2 Validation

```python
def validate_html_mgraph(graph: HtmlMGraph) -> List[str]:
    """Validate HTML graph structure"""
    errors = []
    
    # Check for root node
    if not graph.find_one("html"):
        errors.append("Missing root <html> node")
    
    # Check for body
    if not graph.find_one("body"):
        errors.append("Missing <body> node")
    
    # Check for orphaned nodes
    orphans = graph.find_orphaned_nodes()
    if orphans:
        errors.append(f"Found {len(orphans)} orphaned nodes")
    
    return errors
```

---

## Conclusion

The HTML→MGraph system provides:

1. **Type-safe HTML representation** via schemas
2. **Semantic graph conversion** with 40+ node types
3. **Dual conversion modes** (full structure vs. schema)
4. **Rich querying capabilities** via MGraph operations
5. **Visualization support** with theming (see v1.3.3)
6. **Production-ready patterns** from real-world usage

This system is ready for extraction into a standalone library with minimal refactoring.

**Next Steps**:
- Extract code into standalone repo
- Add comprehensive test suite
- Create example gallery
- Write detailed API documentation
- Publish to PyPI as `html-mgraph`
